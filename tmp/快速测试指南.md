# PawLink é«˜å¾·åœ°å›¾é›†æˆå¿«é€Ÿæµ‹è¯•æŒ‡å—

## æµ‹è¯•å‰å‡†å¤‡

### 1. ç¯å¢ƒè¦æ±‚
- âœ… Node.js >= 18.x
- âœ… Expo CLI (æœ€æ–°ç‰ˆæœ¬)
- âœ… iOS Simulator / Android Emulatorï¼ˆå¯é€‰ï¼‰

### 2. å¯åŠ¨é¡¹ç›®
```bash
# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm start
```

### 3. éªŒè¯APIé…ç½®
æ£€æŸ¥ `config/amap-api-keys.ts` ä¸­çš„APIå¯†é’¥æ˜¯å¦æ­£ç¡®é…ç½®ã€‚

---

## åŠŸèƒ½æµ‹è¯•æ¸…å•

### âœ… æµ‹è¯•1ï¼šæœåŠ¡å±‚éªŒè¯

**æµ‹è¯•ä»£ç **ï¼š
```typescript
// åœ¨ä»»ä½•ç»„ä»¶ä¸­æ·»åŠ 
import AmapService from '@/lib/amap-service';

const testAmapService = async () => {
  const service = AmapService.getInstance();
  console.log('æœåŠ¡å®ä¾‹:', service);

  // æµ‹è¯•é€†åœ°ç†ç¼–ç 
  try {
    const result = await service.regeo({
      longitude: 116.4074,
      latitude: 39.9042
    });
    console.log('âœ… é€†åœ°ç†ç¼–ç æˆåŠŸ:', result?.address);
  } catch (error) {
    console.error('âŒ é€†åœ°ç†ç¼–ç å¤±è´¥:', error);
  }

  // æµ‹è¯•POIæœç´¢
  try {
    const results = await service.searchPOI({
      keyword: 'å® ç‰©åŒ»é™¢',
      city: 'åŒ—äº¬'
    });
    console.log('âœ… POIæœç´¢æˆåŠŸ:', results?.length, 'ä¸ªç»“æœ');
  } catch (error) {
    console.error('âŒ POIæœç´¢å¤±è´¥:', error);
  }
};
```

**æœŸæœ›ç»“æœ**ï¼š
- âœ… æˆåŠŸè¾“å‡ºæœåŠ¡å®ä¾‹
- âœ… æˆåŠŸè¿”å›åŒ—äº¬å¸‚åœ°å€
- âœ… æˆåŠŸè¿”å›POIæœç´¢ç»“æœåˆ—è¡¨

---

### âœ… æµ‹è¯•2ï¼šHookéªŒè¯

**æµ‹è¯•ä»£ç **ï¼š
```typescript
// åœ¨ç»„ä»¶ä¸­
import { useAmap } from '@/hooks/use-amap';

const TestComponent = () => {
  const { loading, error, regeo, searchPOI } = useAmap();

  console.log('HookçŠ¶æ€:', { loading, error });

  const testHook = async () => {
    console.log('å¼€å§‹æµ‹è¯•Hook...');

    // æµ‹è¯•é€†åœ°ç†ç¼–ç 
    const result = await regeo({ longitude: 116.4074, latitude: 39.9042 });
    console.log('Hooké€†åœ°ç†ç¼–ç ç»“æœ:', result);

    // æµ‹è¯•POIæœç´¢
    const results = await searchPOI({ keyword: 'å® ç‰©åŒ»é™¢' });
    console.log('Hook POIæœç´¢ç»“æœ:', results);
  };

  return (
    <View>
      <Button title="æµ‹è¯•Hook" onPress={testHook} />
      {loading && <Text>åŠ è½½ä¸­...</Text>}
      {error && <Text style={{color: 'red'}}>é”™è¯¯: {error}</Text>}
    </View>
  );
};
```

**æœŸæœ›ç»“æœ**ï¼š
- âœ… ç‚¹å‡»æŒ‰é’®åï¼ŒloadingçŠ¶æ€å˜åŒ–
- âœ… æˆåŠŸè°ƒç”¨APIå¹¶è¿”å›ç»“æœ
- âœ… é”™è¯¯æ—¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

---

### âœ… æµ‹è¯•3ï¼šåœ°å›¾ç»„ä»¶éªŒè¯

**æµ‹è¯•æ­¥éª¤**ï¼š
1. æ‰“å¼€é¦–é¡µï¼ˆåœ°å›¾é¡µé¢ï¼‰
2. æŸ¥çœ‹æ˜¯å¦æ˜¾ç¤ºåœ°å›¾
3. ç‚¹å‡»å®šä½æŒ‰é’®
4. æŸ¥çœ‹æ˜¯å¦æ˜¾ç¤ºç”¨æˆ·ä½ç½®
5. æŸ¥çœ‹æ˜¯å¦æœ‰å® ç‰©æ ‡è®°

**æœŸæœ›ç»“æœ**ï¼š
- âœ… åœ°å›¾æ­£å¸¸æ˜¾ç¤º
- âœ… ç‚¹å‡»å®šä½æŒ‰é’®åæ˜¾ç¤ºç”¨æˆ·ä½ç½®
- âœ… æ˜¾ç¤ºç”¨æˆ·åœ°å€ä¿¡æ¯
- âœ… æ˜¾ç¤ºå® ç‰©æ ‡è®°ï¼ˆå¦‚æœ‰æ•°æ®ï¼‰

**éªŒè¯ç‚¹**ï¼š
```typescript
// åœ¨æ§åˆ¶å°æŸ¥çœ‹
console.log('åœ°å›¾åŠ è½½çŠ¶æ€:', mapLoaded);
console.log('ç”¨æˆ·ä½ç½®:', userLocation);
console.log('å® ç‰©æ•°é‡:', pets.length);
```

---

### âœ… æµ‹è¯•4ï¼šæœç´¢åŠŸèƒ½éªŒè¯

**æµ‹è¯•æ­¥éª¤**ï¼š
1. æ‰“å¼€æœç´¢é¡µé¢æˆ–ç­›é€‰ç»„ä»¶
2. åœ¨æœç´¢æ¡†è¾“å…¥"å® ç‰©åŒ»é™¢"
3. æŸ¥çœ‹æ˜¯å¦æ˜¾ç¤ºæœç´¢ç»“æœ
4. ç‚¹å‡»æœç´¢ç»“æœ
5. æŸ¥çœ‹æ˜¯å¦æ›´æ–°ä½ç½®

**æœŸæœ›ç»“æœ**ï¼š
- âœ… è¾“å…¥åæ˜¾ç¤ºè‡ªåŠ¨è¡¥å…¨å»ºè®®
- âœ… ç‚¹å‡»å»ºè®®é¡¹åæ›´æ–°æœç´¢æ¡†
- âœ… æ˜¾ç¤ºé€‰æ‹©çš„ä½ç½®ä¿¡æ¯
- âœ… å¯ä»¥æ¸…é™¤é€‰æ‹©çš„ä½ç½®

**éªŒè¯ç‚¹**ï¼š
```typescript
// åœ¨æ§åˆ¶å°æŸ¥çœ‹
console.log('æœç´¢å…³é”®è¯:', searchKeyword);
console.log('æœç´¢ç»“æœ:', searchResults);
console.log('é€‰ä¸­çš„ä½ç½®:', filters.location);
```

---

### âœ… æµ‹è¯•5ï¼šå®šä½åŠŸèƒ½éªŒè¯

**æµ‹è¯•æ­¥éª¤**ï¼š
1. åœ¨åœ°å›¾é¡µé¢ç‚¹å‡»å®šä½æŒ‰é’®
2. å…è®¸å®šä½æƒé™
3. ç­‰å¾…å®šä½å®Œæˆ
4. æŸ¥çœ‹åœ°å€æ˜¯å¦æ­£ç¡®

**æœŸæœ›ç»“æœ**ï¼š
- âœ… å¼¹å‡ºå®šä½æƒé™è¯·æ±‚
- âœ… å®šä½æˆåŠŸï¼ˆæ˜¾ç¤ºGPSå®šä½æˆ–é«˜å¾·å®šä½ï¼‰
- âœ… æ˜¾ç¤ºå‡†ç¡®çš„ä¸­æ–‡åœ°å€
- âœ… åœ°å›¾ç§»åŠ¨åˆ°ç”¨æˆ·ä½ç½®

**éªŒè¯ç‚¹**ï¼š
```typescript
// åœ¨æ§åˆ¶å°æŸ¥çœ‹
console.log('å®šä½æ–¹æ³•:', locationMethod); // 'native' | 'amap'
console.log('ç”¨æˆ·ä½ç½®:', userLocation);
console.log('åœ°å€ä¿¡æ¯:', userLocation?.address);
```

---

## è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç»„ä»¶ï¼š
```typescript
// components/AmapTest.tsx
import React, { useState } from 'react';
import { View, Text, Button, ScrollView } from 'react-native';
import AmapService from '@/lib/amap-service';
import { useAmap } from '@/hooks/use-amap';

export const AmapTest: React.FC = () => {
  const [results, setResults] = useState<string[]>([]);
  const { regeo, searchPOI, loading } = useAmap();

  const addResult = (message: string) => {
    setResults(prev => [...prev, `${new Date().toLocaleTimeString()}: ${message}`]);
  };

  const test1 = async () => {
    addResult('å¼€å§‹æµ‹è¯•1ï¼šé€†åœ°ç†ç¼–ç ');
    try {
      const service = AmapService.getInstance();
      const result = await service.regeo({ longitude: 116.4074, latitude: 39.9042 });
      addResult(`âœ… æˆåŠŸ: ${result?.address || 'æ— ç»“æœ'}`);
    } catch (error: any) {
      addResult(`âŒ å¤±è´¥: ${error.message}`);
    }
  };

  const test2 = async () => {
    addResult('å¼€å§‹æµ‹è¯•2ï¼šPOIæœç´¢');
    try {
      const service = AmapService.getInstance();
      const results = await service.searchPOI({ keyword: 'å® ç‰©åŒ»é™¢', city: 'åŒ—äº¬' });
      addResult(`âœ… æˆåŠŸ: æ‰¾åˆ°${results.length}ä¸ªç»“æœ`);
    } catch (error: any) {
      addResult(`âŒ å¤±è´¥: ${error.message}`);
    }
  };

  const test3 = async () => {
    addResult('å¼€å§‹æµ‹è¯•3ï¼šHookæµ‹è¯•');
    try {
      const result = await regeo({ longitude: 116.4074, latitude: 39.9042 });
      addResult(`âœ… HookæˆåŠŸ: ${result?.address || 'æ— ç»“æœ'}`);
    } catch (error: any) {
      addResult(`âŒ Hookå¤±è´¥: ${error.message}`);
    }
  };

  const test4 = async () => {
    addResult('å¼€å§‹æµ‹è¯•4ï¼šè¾“å…¥æç¤º');
    try {
      const service = AmapService.getInstance();
      const results = await service.inputTips({ keyword: 'å® ç‰©', datatype: 'poi' });
      addResult(`âœ… è¾“å…¥æç¤ºæˆåŠŸ: æ‰¾åˆ°${results.length}ä¸ªå»ºè®®`);
    } catch (error: any) {
      addResult(`âŒ è¾“å…¥æç¤ºå¤±è´¥: ${error.message}`);
    }
  };

  const test5 = async () => {
    addResult('å¼€å§‹æµ‹è¯•5ï¼šè·¯å¾„è§„åˆ’');
    try {
      const service = AmapService.getInstance();
      const route = await service.getRoute({
        from: { longitude: 116.4074, latitude: 39.9042 },
        to: { longitude: 116.3974, latitude: 39.9042 },
        mode: 'driving'
      });
      addResult(`âœ… è·¯å¾„è§„åˆ’æˆåŠŸ: è·ç¦»${route?.distance || 0}ç±³`);
    } catch (error: any) {
      addResult(`âŒ è·¯å¾„è§„åˆ’å¤±è´¥: ${error.message}`);
    }
  };

  return (
    <ScrollView style={{ padding: 16 }}>
      <Text style={{ fontSize: 20, fontWeight: 'bold', marginBottom: 16 }}>
        é«˜å¾·åœ°å›¾åŠŸèƒ½æµ‹è¯•
      </Text>

      <Button title="æµ‹è¯•1: é€†åœ°ç†ç¼–ç " onPress={test1} disabled={loading} />
      <View style={{ height: 8 }} />
      <Button title="æµ‹è¯•2: POIæœç´¢" onPress={test2} disabled={loading} />
      <View style={{ height: 8 }} />
      <Button title="æµ‹è¯•3: Hookæµ‹è¯•" onPress={test3} disabled={loading} />
      <View style={{ height: 8 }} />
      <Button title="æµ‹è¯•4: è¾“å…¥æç¤º" onPress={test4} disabled={loading} />
      <View style={{ height: 8 }} />
      <Button title="æµ‹è¯•5: è·¯å¾„è§„åˆ’" onPress={test5} disabled={loading} />

      <View style={{ height: 16 }} />
      <Text style={{ fontSize: 16, fontWeight: '600' }}>æµ‹è¯•ç»“æœ:</Text>
      <View style={{ height: 8 }} />

      {results.map((result, index) => (
        <Text key={index} style={{ marginBottom: 4, fontFamily: 'monospace' }}>
          {result}
        </Text>
      ))}

      <View style={{ height: 32 }} />
      {loading && <Text style={{ color: 'blue' }}>âš™ï¸ æ­£åœ¨æ‰§è¡Œæµ‹è¯•...</Text>}
    </ScrollView>
  );
};
```

---

## æµ‹è¯•ç»“æœåˆ¤æ–­

### âœ… é€šè¿‡æ ‡å‡†

1. **é€†åœ°ç†ç¼–ç æµ‹è¯•**
   - âœ… èƒ½æ­£ç¡®è¿”å›ä¸­æ–‡åœ°å€
   - âœ… åæ ‡ç²¾åº¦æ­£ç¡®
   - âœ… ç¼“å­˜æœºåˆ¶å·¥ä½œ

2. **POIæœç´¢æµ‹è¯•**
   - âœ… è¿”å›æœç´¢ç»“æœåˆ—è¡¨
   - âœ… ç»“æœåŒ…å«å¿…è¦ä¿¡æ¯ï¼ˆåç§°ã€åœ°å€ã€åæ ‡ï¼‰
   - âœ… æ”¯æŒä½ç½®å…³è”æœç´¢

3. **Hookæµ‹è¯•**
   - âœ… loadingçŠ¶æ€æ­£å¸¸å˜åŒ–
   - âœ… é”™è¯¯å¤„ç†æ­£å¸¸
   - âœ… APIè°ƒç”¨æ­£å¸¸

4. **è¾“å…¥æç¤ºæµ‹è¯•**
   - âœ… è¿”å›è‡ªåŠ¨è¡¥å…¨å»ºè®®
   - âœ… å»ºè®®åŒ…å«åæ ‡ä¿¡æ¯

5. **è·¯å¾„è§„åˆ’æµ‹è¯•**
   - âœ… è¿”å›è·¯çº¿ä¿¡æ¯
   - âœ… åŒ…å«è·ç¦»ã€æ—¶é—´ã€è·¯å¾„ç‚¹

### âŒ å¸¸è§é—®é¢˜

1. **APIè°ƒç”¨å¤±è´¥**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - æ£€æŸ¥APIå¯†é’¥é…ç½®
   - æŸ¥çœ‹é”™è¯¯ä¿¡æ¯

2. **å®šä½å¤±è´¥**
   - æ£€æŸ¥å®šä½æƒé™
   - æ£€æŸ¥GPSè®¾ç½®
   - æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—

3. **åœ°å›¾ä¸æ˜¾ç¤º**
   - æ£€æŸ¥WebViewä¾èµ–
   - æ£€æŸ¥APIå¯†é’¥
   - æŸ¥çœ‹ç½‘ç»œè¯·æ±‚

---

## æ—¥å¿—æŸ¥çœ‹

### å¼€å‘ç¯å¢ƒæ—¥å¿—
```bash
# æŸ¥çœ‹Metroæ—¥å¿—
npm start

# æŸ¥çœ‹è®¾å¤‡æ—¥å¿—
# Android
adb logcat | grep PawLink

# iOS (åœ¨Xcodeä¸­æŸ¥çœ‹)
```

### æ§åˆ¶å°è¾“å‡º
```typescript
// åœ¨ä»£ç ä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—
console.log('ğŸ—ºï¸ é«˜å¾·åœ°å›¾æœåŠ¡:', service);
console.log('ğŸ“ é€†åœ°ç†ç¼–ç ç»“æœ:', result);
console.log('ğŸ” POIæœç´¢ç»“æœ:', results);
console.log('ğŸš— è·¯å¾„è§„åˆ’ç»“æœ:', route);
```

---

## æ€§èƒ½æµ‹è¯•

### ç¼“å­˜æ•ˆæœæµ‹è¯•
```typescript
// ç¬¬ä¸€æ¬¡è°ƒç”¨
const t1 = Date.now();
await regeo(coord);
const time1 = Date.now() - t1;
console.log(`ç¬¬ä¸€æ¬¡è°ƒç”¨è€—æ—¶: ${time1}ms`);

// ç¬¬äºŒæ¬¡è°ƒç”¨ï¼ˆç¼“å­˜å‘½ä¸­ï¼‰
const t2 = Date.now();
await regeo(coord);
const time2 = Date.now() - t2;
console.log(`ç¬¬äºŒæ¬¡è°ƒç”¨è€—æ—¶: ${time2}ms`);

// é¢„æœŸï¼štime2 < time1ï¼ˆç¼“å­˜å‘½ä¸­æ›´å¿«ï¼‰
```

### æ‰¹é‡æŸ¥è¯¢æµ‹è¯•
```typescript
// åˆ›å»º30ä¸ªåæ ‡ç‚¹
const coords = Array.from({ length: 30 }, (_, i) => ({
  longitude: 116.4074 + i * 0.001,
  latitude: 39.9042 + i * 0.001
}));

const t1 = Date.now();
await service.regeo(coords[0], { batch: coords });
const time = Date.now() - t1;
console.log(`æ‰¹é‡æŸ¥è¯¢30ä¸ªåæ ‡è€—æ—¶: ${time}ms`);

// é¢„æœŸï¼šæ¯”30æ¬¡å•ç‹¬æŸ¥è¯¢å¿«
```

---

## æµ‹è¯•ç¯å¢ƒé…ç½®

### å¼€å‘ç¯å¢ƒ
```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export EXPO_PUBLIC_AMAP_API_KEY=your_api_key_here

# å¯åŠ¨é¡¹ç›®
npm start
```

### æµ‹è¯•æ•°æ®
```typescript
// æµ‹è¯•åæ ‡
const testCoords = {
  beijing: { longitude: 116.4074, latitude: 39.9042 },
  shanghai: { longitude: 121.4737, latitude: 31.2304 },
  guangzhou: { longitude: 113.2644, latitude: 23.1291 }
};

// æµ‹è¯•å…³é”®è¯
const testKeywords = [
  'å® ç‰©åŒ»é™¢',
  'å® ç‰©åº—',
  'å…½åŒ»é™¢',
  'å® ç‰©æ•‘åŠ©ç«™',
  'åŠ¨ç‰©åŒ»é™¢'
];
```

---

## éªŒæ”¶æ ‡å‡†

### å¿…é¡»é€šè¿‡çš„æµ‹è¯•
- [ ] é€†åœ°ç†ç¼–ç è¿”å›æ­£ç¡®åœ°å€
- [ ] POIæœç´¢è¿”å›ç»“æœåˆ—è¡¨
- [ ] è¾“å…¥æç¤ºè¿”å›å»ºè®®
- [ ] è·¯å¾„è§„åˆ’è¿”å›è·¯çº¿
- [ ] ç¼“å­˜æœºåˆ¶å·¥ä½œæ­£å¸¸
- [ ] é”™è¯¯å¤„ç†æ­£ç¡®æ˜¾ç¤º
- [ ] åŠ è½½çŠ¶æ€æ­£ç¡®å˜åŒ–

### åŠ åˆ†é¡¹
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡ï¼ˆç¼“å­˜å‘½ä¸­<10msï¼‰
- [ ] æ‰¹é‡æŸ¥è¯¢æ•ˆç‡é«˜
- [ ] ä¸‰ç«¯å…¼å®¹æ€§æµ‹è¯•é€šè¿‡
- [ ] é•¿æ—¶é—´è¿è¡Œç¨³å®š

---

**æµ‹è¯•æŒ‡å—ç‰ˆæœ¬**ï¼šv1.0
**é€‚ç”¨ç‰ˆæœ¬**ï¼šfeature/mvp-iteration-1
**æµ‹è¯•çŠ¶æ€**ï¼šâœ… å¯ç«‹å³æµ‹è¯•
