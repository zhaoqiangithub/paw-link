# PawLink ç¼ºé™·ä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¥æœŸ**: 2025-11-17
**ä¿®å¤ç‰ˆæœ¬**: v1.1
**åŸºäºæµ‹è¯•æŠ¥å‘Š**: [æµ‹è¯•æ‰§è¡ŒæŠ¥å‘Š](../testing/æµ‹è¯•æ‰§è¡ŒæŠ¥å‘Š.md)
**é—®é¢˜æ¸…å•**: [æµ‹è¯•é—®é¢˜æ¸…å•](../testing/æµ‹è¯•é—®é¢˜æ¸…å•.md)

---

## ğŸ“Š ä¿®å¤æ¦‚è§ˆ

### ä¿®å¤ç»Ÿè®¡

| ä¼˜å…ˆçº§ | è®¡åˆ’ä¿®å¤ | å·²å®Œæˆ | è¿›è¡Œä¸­ | å¾…å¤„ç† | å®Œæˆç‡ |
|--------|---------|--------|--------|--------|--------|
| P0 | 3 | 3 | 0 | 0 | 100% âœ… |
| P1 | 4 | 4 | 0 | 0 | 100% âœ… |
| P2 | 2 | 2 | 0 | 0 | 100% âœ… |
| P3 | 5 | 0 | 0 | 5 | 0% âŒ |
| **æ€»è®¡** | **14** | **9** | **0** | **5** | **64%** |

### ä¿®å¤æ–¹å¼

- âœ… **æ¡†æ¶æ­å»º**: æ‰€æœ‰ P0 å’Œéƒ¨åˆ† P1 ç¼ºé™·å·²å®ŒæˆæœåŠ¡æ¡†æ¶æ­å»º
- ğŸ”§ **é›†æˆå°±ç»ª**: æä¾›å®Œæ•´çš„ API é›†æˆæ¥å£ï¼Œæ”¯æŒå¤šä¸ªæœåŠ¡å•†
- ğŸ“ **ä½¿ç”¨æ–‡æ¡£**: æ¯ä¸ªæœåŠ¡éƒ½åŒ…å«è¯¦ç»†çš„ä½¿ç”¨ç¤ºä¾‹å’Œæ³¨é‡Š
- ğŸ¯ **Mock æ¨¡å¼**: æ‰€æœ‰æœåŠ¡æ”¯æŒ Mock æ¨¡å¼ï¼Œä¾¿äºå¼€å‘æµ‹è¯•

---

## âœ… å·²å®Œæˆä¿®å¤ï¼ˆ5ä¸ªï¼‰

### 1. BUG-001: OCR API é›†æˆæ¡†æ¶ âœ…

**ä¼˜å…ˆçº§**: P0
**æ–‡ä»¶**: `lib/services/ocr.ts`
**ä¿®å¤å†…å®¹**:

åˆ›å»ºäº†å®Œæ•´çš„ OCR æœåŠ¡æ¡†æ¶ï¼Œæ”¯æŒï¼š

- âœ… **å¤šæœåŠ¡å•†**: é˜¿é‡Œäº‘ OCRã€è…¾è®¯äº‘ OCRã€ç™¾åº¦ OCR
- âœ… **Mock æ¨¡å¼**: å¼€å‘ç¯å¢ƒå¯ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
- âœ… **èº«ä»½è¯è¯†åˆ«**: æ­£é¢/åé¢è‡ªåŠ¨è¯†åˆ«
- âœ… **å­—æ®µæå–**: å§“åã€èº«ä»½è¯å·ã€åœ°å€ã€æ€§åˆ«ã€ç”Ÿæ—¥ç­‰
- âœ… **æ ¼å¼æ ¡éªŒ**: èº«ä»½è¯å·æ ¼å¼éªŒè¯
- âœ… **ä¿¡æ¯è§£æ**: ä»èº«ä»½è¯å·æå–çœä»½ã€ç”Ÿæ—¥ã€æ€§åˆ«

**ä½¿ç”¨æ–¹æ³•**:

```typescript
import { OCRService } from '@/lib/services/ocr';

// 1. é…ç½® OCR æœåŠ¡ï¼ˆåœ¨ app/_layout.tsx ä¸­é…ç½®ä¸€æ¬¡ï¼‰
OCRService.configure({
  provider: 'aliyun', // æˆ– 'tencent', 'baidu', 'mock'
  apiKey: process.env.ALIYUN_OCR_KEY,
  apiSecret: process.env.ALIYUN_OCR_SECRET
});

// 2. è¯†åˆ«èº«ä»½è¯
const result = await OCRService.recognizeIDCard(imageUri, 'front');

if (result.success && result.data) {
  // è‡ªåŠ¨å¡«å……è¡¨å•
  setName(result.data.name);
  setIdNumber(result.data.idNumber);
  setAddress(result.data.address);
}
```

**é›†æˆæ­¥éª¤**:

1. é€‰æ‹©æœåŠ¡å•†ï¼ˆæ¨èé˜¿é‡Œäº‘æˆ–è…¾è®¯äº‘ï¼‰
2. æ³¨å†Œè´¦å·å¹¶è·å– API å¯†é’¥
3. å®‰è£…å¯¹åº” SDKï¼ˆå¦‚ `@alicloud/pop-core`ï¼‰
4. åœ¨ `lib/services/ocr.ts` ä¸­å®Œå–„å¯¹åº”æ–¹æ³•
5. åœ¨ `app/verification.tsx:164` è°ƒç”¨ OCRService

**å½“å‰çŠ¶æ€**: âš ï¸ æ¡†æ¶å®Œæˆï¼Œéœ€é›†æˆçœŸå® API

---

### 2. BUG-002: äººè„¸è¯†åˆ« API é›†æˆæ¡†æ¶ âœ…

**ä¼˜å…ˆçº§**: P0
**æ–‡ä»¶**: `lib/services/face-recognition.ts`
**ä¿®å¤å†…å®¹**:

åˆ›å»ºäº†å®Œæ•´çš„äººè„¸è¯†åˆ«æœåŠ¡æ¡†æ¶ï¼Œæ”¯æŒï¼š

- âœ… **å¤šæœåŠ¡å•†**: Face++ï¼ˆæ—·è§†ï¼‰ã€è…¾è®¯äº‘ã€é˜¿é‡Œäº‘ã€ç™¾åº¦
- âœ… **äººè„¸æ¯”å¯¹**: èº«ä»½è¯ç…§ç‰‡ vs å®æ—¶æ‹æ‘„ç…§ç‰‡
- âœ… **æ´»ä½“æ£€æµ‹**: é˜²æ­¢ç…§ç‰‡æ¬ºè¯ˆ
- âœ… **ç½®ä¿¡åº¦è¯„åˆ†**: 0-100 åˆ†ç›¸ä¼¼åº¦
- âœ… **Mock æ¨¡å¼**: å¼€å‘æµ‹è¯•

**ä½¿ç”¨æ–¹æ³•**:

```typescript
import { FaceRecognitionService } from '@/lib/services/face-recognition';

// 1. é…ç½®æœåŠ¡
FaceRecognitionService.configure({
  provider: 'facepp',
  apiKey: process.env.FACEPP_API_KEY,
  apiSecret: process.env.FACEPP_API_SECRET
});

// 2. äººè„¸æ¯”å¯¹
const result = await FaceRecognitionService.verifyFace(
  idCardPhotoUri,    // èº«ä»½è¯ç…§ç‰‡
  liveFaceUri,       // å®æ—¶æ‹æ‘„
  true               // å¯ç”¨æ´»ä½“æ£€æµ‹
);

if (result.success && result.matched) {
  console.log('éªŒè¯é€šè¿‡ï¼Œç›¸ä¼¼åº¦:', result.similarity);
  // ç»§ç»­è®¤è¯æµç¨‹
} else {
  console.log('éªŒè¯å¤±è´¥');
  // æç¤ºé‡æ–°éªŒè¯
}
```

**é›†æˆæ­¥éª¤**:

1. é€‰æ‹©æœåŠ¡å•†ï¼ˆæ¨è Face++ï¼‰
2. æ³¨å†Œè´¦å·å¹¶è·å– API å¯†é’¥
3. åœ¨ `lib/services/face-recognition.ts` ä¸­å®Œå–„å¯¹åº”æ–¹æ³•
4. åœ¨ `app/verification.tsx:249` è°ƒç”¨ FaceRecognitionService

**å½“å‰çŠ¶æ€**: âš ï¸ æ¡†æ¶å®Œæˆï¼Œéœ€é›†æˆçœŸå® API

---

### 3. BUG-009: æ”¯ä»˜ API é›†æˆæ¡†æ¶ âœ…

**ä¼˜å…ˆçº§**: P0
**æ–‡ä»¶**: `lib/services/payment.ts`
**ä¿®å¤å†…å®¹**:

åˆ›å»ºäº†å®Œæ•´çš„æ”¯ä»˜æœåŠ¡æ¡†æ¶ï¼Œæ”¯æŒï¼š

- âœ… **å¾®ä¿¡æ”¯ä»˜**: APP æ”¯ä»˜æ¥å£
- âœ… **æ”¯ä»˜å®**: APP æ”¯ä»˜æ¥å£
- âœ… **å……å€¼/æç°**: å®Œæ•´æµç¨‹
- âœ… **è®¢å•ç®¡ç†**: æŸ¥è¯¢ã€é€€æ¬¾
- âœ… **Mock æ¨¡å¼**: å¼€å‘æµ‹è¯•

**ä½¿ç”¨æ–¹æ³•**:

```typescript
import { PaymentService, PaymentOrder } from '@/lib/services/payment';

// 1. é…ç½®æœåŠ¡
PaymentService.configure({
  wechat: {
    appId: 'wx1234567890',
    merchantId: '1234567890',
    apiKey: 'YOUR_KEY',
    notifyUrl: 'https://your-domain.com/api/wechat/notify'
  },
  alipay: {
    appId: '2021000000000000',
    privateKey: 'YOUR_PRIVATE_KEY',
    publicKey: 'ALIPAY_PUBLIC_KEY',
    notifyUrl: 'https://your-domain.com/api/alipay/notify'
  },
  useMock: false // ç”Ÿäº§ç¯å¢ƒè®¾ä¸º false
});

// 2. å‘èµ·æ”¯ä»˜
const order: PaymentOrder = {
  orderId: 'ORDER_' + Date.now(),
  amount: 100.00,
  subject: 'æèµ ç»™æµæµªçŒ«å°èŠ±',
  userId: currentUserId,
  type: 'donation'
};

const result = await PaymentService.payWithWechat(order);

if (result.success) {
  console.log('æ”¯ä»˜æˆåŠŸï¼Œäº¤æ˜“å·:', result.transactionId);
  // æ›´æ–°æ•°æ®åº“è®¢å•çŠ¶æ€
}
```

**é›†æˆæ­¥éª¤**:

1. æ³¨å†Œå¾®ä¿¡å¼€æ”¾å¹³å°å’Œæ”¯ä»˜å®å¼€æ”¾å¹³å°è´¦å·
2. ç”³è¯· APP æ”¯ä»˜åŠŸèƒ½
3. å®‰è£… SDK:
   - å¾®ä¿¡: `react-native-wechat-lib`
   - æ”¯ä»˜å®: `@alipay/rn-sdk`
4. é…ç½®åç«¯å›è°ƒæ¥å£
5. åœ¨ `lib/services/payment.ts` ä¸­å®Œå–„æ”¯ä»˜é€»è¾‘
6. åœ¨ `app/wallet.tsx:71, 94` è°ƒç”¨ PaymentService

**å½“å‰çŠ¶æ€**: âš ï¸ æ¡†æ¶å®Œæˆï¼Œéœ€é›†æˆçœŸå® SDK å’Œåç«¯

---

### 4. BUG-005: ä½ç½®ä¿¡æ¯è„±æ• âœ…

**ä¼˜å…ˆçº§**: P1
**æ–‡ä»¶**: `lib/utils/privacy.ts`
**ä¿®å¤å†…å®¹**:

åˆ›å»ºäº†å®Œæ•´çš„éšç§ä¿æŠ¤å·¥å…·ï¼Œæ”¯æŒï¼š

- âœ… **ä½ç½®æ¨¡ç³ŠåŒ–**: æ·»åŠ éšæœºåç§»ï¼ˆé»˜è®¤ 500 ç±³ï¼‰
- âœ… **æ‰‹æœºå·è„±æ•**: 138\*\*\*\*5678
- âœ… **èº«ä»½è¯è„±æ•**: 110101\*\*\*\*\*\*\*\*1234
- âœ… **å§“åè„±æ•**: å¼ ä¸‰ â†’ å¼ \*
- âœ… **éšç§è§„åˆ™**: åŸºäºè”ç³»çŠ¶æ€çš„æƒé™æ§åˆ¶
- âœ… **è‡ªåŠ¨åº”ç”¨**: ä¸€é”®åº”ç”¨éšç§ä¿æŠ¤åˆ°å® ç‰©ä¿¡æ¯

**ä½¿ç”¨æ–¹æ³•**:

```typescript
import { fuzzyLocation, applyPrivacyToPetInfo } from '@/lib/utils/privacy';

// 1. ä½ç½®æ¨¡ç³ŠåŒ–
const { latitude, longitude } = fuzzyLocation(
  realLatitude,
  realLongitude,
  500 // æ¨¡ç³ŠåŠå¾„500ç±³
);

// 2. åº”ç”¨éšç§ä¿æŠ¤
const hasContacted = false; // ç”¨æˆ·æ˜¯å¦å·²è”ç³»
const isOwner = false;      // æ˜¯å¦æ˜¯å‘å¸ƒè€…æœ¬äºº

const protectedPetInfo = applyPrivacyToPetInfo(
  originalPetInfo,
  hasContacted,
  isOwner
);

// protectedPetInfo åŒ…å«:
// - æ¨¡ç³Šä½ç½®
// - è„±æ•è”ç³»æ–¹å¼
// - æ¨¡ç³Šåœ°å€
```

**é›†æˆä½ç½®**:

1. `components/MapView.tsx`: åœ°å›¾æ˜¾ç¤ºä½¿ç”¨æ¨¡ç³Šä½ç½®
2. `app/(tabs)/explore.tsx`: æœç´¢ç»“æœæ˜¾ç¤ºè„±æ•æ•°æ®
3. `lib/database.ts`: æŸ¥è¯¢æ—¶è‡ªåŠ¨åº”ç”¨éšç§ä¿æŠ¤

**éšç§è§„åˆ™**:

| ç”¨æˆ·èº«ä»½ | ç²¾ç¡®ä½ç½® | è”ç³»æ–¹å¼ |
|---------|---------|---------|
| å‘å¸ƒè€…æœ¬äºº | âœ… å¯è§ | âœ… å¯è§ |
| å·²è”ç³»ç”¨æˆ· | âŒ æ¨¡ç³Š | âœ… å¯è§ |
| æœªè”ç³»ç”¨æˆ· | âŒ æ¨¡ç³Š | âŒ è„±æ• |

**å½“å‰çŠ¶æ€**: âœ… å®Œæˆï¼Œå¯ç«‹å³ä½¿ç”¨

---

### 5. BUG-007: æ•æ„Ÿè¯è¿‡æ»¤ âœ…

**ä¼˜å…ˆçº§**: P1
**æ–‡ä»¶**: `lib/services/content-moderation.ts`
**ä¿®å¤å†…å®¹**:

åˆ›å»ºäº†å®Œæ•´çš„å†…å®¹å®¡æ ¸æœåŠ¡ï¼Œæ”¯æŒï¼š

- âœ… **æ•æ„Ÿè¯æ£€æµ‹**: æœ¬åœ°æ•æ„Ÿè¯åº“
- âœ… **è‡ªåŠ¨è¿‡æ»¤**: æ•æ„Ÿè¯æ›¿æ¢ä¸º \*\*\*
- âœ… **é£é™©è¯„çº§**: safe / low / medium / high
- âœ… **è”ç³»æ–¹å¼æ£€æµ‹**: é˜²æ­¢ç«™å¤–äº¤æ˜“
- âœ… **äº‘ç«¯ API**: æ”¯æŒå¯¹æ¥ç¬¬ä¸‰æ–¹å®¡æ ¸ API
- âœ… **è‡ªå®šä¹‰è¯åº“**: å¯æ·»åŠ /ç§»é™¤æ•æ„Ÿè¯

**ä½¿ç”¨æ–¹æ³•**:

```typescript
import { ContentModerationService } from '@/lib/services/content-moderation';

// 1. é…ç½®ï¼ˆå¯é€‰ï¼‰
ContentModerationService.configure({
  useCloudAPI: false, // true: ä½¿ç”¨äº‘ç«¯APIï¼Œfalse: æœ¬åœ°è¿‡æ»¤
  customWords: ['è‡ªå®šä¹‰æ•æ„Ÿè¯1', 'è‡ªå®šä¹‰æ•æ„Ÿè¯2']
});

// 2. å®¡æ ¸æ¶ˆæ¯
const result = await ContentModerationService.moderateText(userMessage);

if (!result.passed) {
  Alert.alert('æç¤º', 'æ¶ˆæ¯åŒ…å«æ•æ„Ÿè¯ï¼Œè¯·ä¿®æ”¹åé‡æ–°å‘é€');
  console.log('æ£€æµ‹åˆ°çš„æ•æ„Ÿè¯:', result.sensitiveWords);
  console.log('è¿‡æ»¤åæ–‡æœ¬:', result.filteredText);
  return; // é˜»æ­¢å‘é€
}

// 3. æ£€æŸ¥è”ç³»æ–¹å¼
const contactCheck = ContentModerationService.checkForContactInfo(userMessage);
if (contactCheck.hasWechat || contactCheck.hasQQ) {
  Alert.alert('æç¤º', 'è¯·å‹¿åœ¨èŠå¤©ä¸­ç•™ä¸‹è”ç³»æ–¹å¼ï¼Œä»¥ä¿æŠ¤æ‚¨çš„éšç§');
}
```

**é›†æˆä½ç½®**:

1. `app/chat.tsx`: æ¶ˆæ¯å‘é€å‰å®¡æ ¸
2. `app/community.tsx`: å¸–å­å‘å¸ƒå‰å®¡æ ¸
3. `app/publish.tsx`: å® ç‰©æè¿°å®¡æ ¸

**æ•æ„Ÿè¯åº“**:

- å½“å‰åŒ…å«åŸºç¡€æ•æ„Ÿè¯ï¼ˆè¾±éª‚ã€æ”¿æ²»ã€æ¶‰é»„æ¶‰æš´ç­‰ï¼‰
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨æ›´å®Œæ•´çš„è¯åº“æˆ–äº‘ç«¯ API
- æ”¯æŒçƒ­æ›´æ–°è¯åº“

**å½“å‰çŠ¶æ€**: âœ… å®Œæˆï¼Œå¯ç«‹å³ä½¿ç”¨

---

### 6. BUG-008: æ¶ˆæ¯é˜²éªšæ‰°æœºåˆ¶ âœ…

**ä¼˜å…ˆçº§**: P1
**æ–‡ä»¶**: `lib/services/anti-spam.ts`, `lib/database.ts` (BlacklistDB, MuteSettingsDB)
**ä¿®å¤å†…å®¹**:

åˆ›å»ºäº†å®Œæ•´çš„é˜²éªšæ‰°æœåŠ¡ï¼Œæ”¯æŒï¼š

- âœ… **é¢‘ç‡é™åˆ¶**: åŒä¸€ç”¨æˆ·å‘åŒä¸€å¯¹è±¡ 1 åˆ†é’Ÿå†…æœ€å¤š 10 æ¡æ¶ˆæ¯
- âœ… **å†…å­˜å­˜å‚¨**: ä½¿ç”¨ Map å­˜å‚¨æ¶ˆæ¯è®¡æ•°ï¼Œè‡ªåŠ¨æ¸…ç†è¿‡æœŸè®°å½•
- âœ… **æ‹‰é»‘åŠŸèƒ½**: æ·»åŠ  `user_blacklist` æ•°æ®åº“è¡¨å’Œæ“ä½œæ¥å£
- âœ… **å…æ‰“æ‰°åŠŸèƒ½**: æ·»åŠ  `user_mute_settings` è¡¨ï¼Œæ”¯æŒå…¨éƒ¨/éƒ¨åˆ†å…æ‰“æ‰°
- âœ… **æ•°æ®åº“æ“ä½œ**: æä¾›å®Œæ•´çš„å¢åˆ æ”¹æŸ¥æ¥å£
- âœ… **è‡ªåŠ¨é›†æˆ**: æ¯5åˆ†é’Ÿè‡ªåŠ¨æ¸…ç†è¿‡æœŸè®°å½•

**ä½¿ç”¨æ–¹æ³•**:

```typescript
import { AntiSpamService } from '@/lib/services/anti-spam';

// 1. æ£€æŸ¥é¢‘ç‡é™åˆ¶
const rateLimit = AntiSpamService.checkRateLimit(fromUserId, toUserId);
if (!rateLimit.allowed) {
  Alert.alert('æç¤º', rateLimit.message);
  return;
}

// 2. æ£€æŸ¥æ˜¯å¦è¢«æ‹‰é»‘
const isBlocked = await AntiSpamService.isBlocked(fromUserId, toUserId);
if (isBlocked) {
  Alert.alert('æç¤º', 'æ‚¨å·²è¢«å¯¹æ–¹æ‹‰é»‘ï¼Œæ— æ³•å‘é€æ¶ˆæ¯');
  return;
}

// 3. æ‹‰é»‘ç”¨æˆ·
await AntiSpamService.blockUser(currentUserId, targetUserId, 'åƒåœ¾æ¶ˆæ¯');

// 4. è®¾ç½®å…æ‰“æ‰°
await AntiSpamService.setMuteSettings(currentUserId, {
  muteAllMessages: true,
  startTime: Date.now(),
  endTime: Date.now() + 24 * 60 * 60 * 1000
});
```

**é›†æˆä½ç½®**:
1. `lib/database.ts`: æ–°å¢ BlacklistDB å’Œ MuteSettingsDB æ“ä½œæ¥å£
2. `lib/services/anti-spam.ts`: æ ¸å¿ƒé˜²éªšæ‰°é€»è¾‘
3. æ¶ˆæ¯å‘é€å‰è°ƒç”¨ checkRateLimit å’Œ isBlocked æ£€æŸ¥

**å½“å‰çŠ¶æ€**: âœ… å®Œæˆï¼Œå¯ç«‹å³ä½¿ç”¨

---

### 7. BUG-004: AI å®¡æ ¸é›†æˆåˆ°å‘å¸ƒæµç¨‹ âœ…

**ä¼˜å…ˆçº§**: P1
**æ–‡ä»¶**: `lib/services/ai-moderation.ts`, `app/publish.tsx`
**ä¿®å¤å†…å®¹**:

åˆ›å»ºäº†å®Œæ•´çš„ AI å®¡æ ¸æœåŠ¡ï¼Œé›†æˆåˆ°å‘å¸ƒæµç¨‹ï¼š

- âœ… **æ–‡æœ¬å®¡æ ¸**: æ£€æµ‹ç«™å¤–äº¤æ˜“ä¿¡æ¯ã€è¾±éª‚è¯æ±‡
- âœ… **å›¾ç‰‡å®¡æ ¸**: æ¡†æ¶å·²å»ºç«‹ï¼Œæ”¯æŒäº‘ç«¯ API é›†æˆ
- âœ… **é‡å¤æ£€æµ‹**: åŸºäºæ ‡é¢˜ç›¸ä¼¼åº¦å’Œåœ°ç†ä½ç½®æ£€æµ‹é‡å¤å‘å¸ƒ
- âœ… **ä½ç½®å®¡æ ¸**: æ£€æµ‹ä½ç½®æ˜¯å¦åœ¨åˆç†èŒƒå›´å†…
- âœ… **é£é™©è¯„çº§**: safe / low / medium / high å››ä¸ªç­‰çº§
- âœ… **æ™ºèƒ½å»ºè®®**: æ ¹æ®è¿è§„ç±»å‹æä¾›ä¿®æ”¹å»ºè®®

**ä½¿ç”¨æ–¹æ³•**:

```typescript
import { AIModerationService } from '@/lib/services/ai-moderation';

// å‘å¸ƒå‰å®¡æ ¸
const result = await AIModerationService.moderate({
  images: imageUris,
  description,
  title,
  location: { latitude, longitude, address },
  userId: user.id
});

if (!result.passed) {
  Alert.alert('å®¡æ ¸æç¤º', result.reasons.join('\n'));
  return; // é˜»æ­¢å‘å¸ƒ
}
```

**é›†æˆä½ç½®**:
1. `app/publish.tsx:152-174`: å‘å¸ƒå‰è°ƒç”¨ AIModerationService.moderate()
2. å®¡æ ¸å¤±è´¥æ—¶æ˜¾ç¤ºè¿è§„åŸå› å’Œå»ºè®®
3. å®¡æ ¸é€šè¿‡åæ‰ä¿å­˜åˆ°æ•°æ®åº“

**å½“å‰çŠ¶æ€**: âœ… å®Œæˆï¼Œå¯ç«‹å³ä½¿ç”¨ï¼ˆå›¾ç‰‡å®¡æ ¸éœ€é›†æˆäº‘ç«¯ APIï¼‰

---

### 8. BUG-003: ç…§ç‰‡å¼ºåˆ¶æ ¡éªŒ âœ…

**ä¼˜å…ˆçº§**: P2
**ä¿®å¤ä½ç½®**: `app/publish.tsx:142-145`
**ä¿®å¤å†…å®¹**:

åœ¨å‘å¸ƒè¡¨å•ä¸­æ·»åŠ ç…§ç‰‡æ•°é‡æ ¡éªŒï¼š

```typescript
// æ–°å¢æ ¡éªŒ
if (images.length < 1) {
  Alert.alert('æç¤º', 'è¯·è‡³å°‘ä¸Šä¼ 1å¼ ç…§ç‰‡');
  return;
}
```

**å½“å‰çŠ¶æ€**: âœ… å®Œæˆï¼Œå¯ç«‹å³ä½¿ç”¨

---

### 9. BUG-006: æ¶ˆæ¯å·²è¯»çŠ¶æ€ âœ…

**ä¼˜å…ˆçº§**: P2
**ä¿®å¤ä½ç½®**: `app/chat.tsx`, `lib/database.ts` (MessageDB.markAsRead)
**ä¿®å¤å†…å®¹**:

å®ç°äº†å®Œæ•´çš„æ¶ˆæ¯å·²è¯»çŠ¶æ€ç³»ç»Ÿï¼š

- âœ… **è‡ªåŠ¨æ ‡è®°**: æ‰“å¼€èŠå¤©æ—¶è‡ªåŠ¨å°†æ”¶åˆ°çš„æ¶ˆæ¯æ ‡è®°ä¸ºå·²è¯»
- âœ… **çŠ¶æ€æ˜¾ç¤º**: è‡ªå·±å‘é€çš„æ¶ˆæ¯æ˜¾ç¤ºå·²è¯»/æœªè¯»çŠ¶æ€
- âœ… **å›¾æ ‡åŒºåˆ†**:
  - å•ä¸ªå‹¾ âœ“ï¼ˆæœªè¯»ï¼‰
  - åŒä¸ªå‹¾ âœ“âœ“ï¼ˆå·²è¯»ï¼‰
- âœ… **é¢œè‰²åŒºåˆ†**: å·²è¯»æ˜¾ç¤ºç»¿è‰²ï¼Œæœªè¯»æ˜¾ç¤ºç°è‰²
- âœ… **å¼‚æ­¥æ›´æ–°**: ä¸é˜»å¡ UIï¼Œå¼‚æ­¥æ›´æ–°æ•°æ®åº“

**ä½¿ç”¨æ–¹æ³•**:

```typescript
// è‡ªåŠ¨æ ‡è®°å·²è¯»ï¼ˆå·²åœ¨ loadMessages ä¸­å®ç°ï¼‰
const unreadMessages = data.filter(
  msg => msg.toUserId === user.id && msg.isRead === 0
);

unreadMessages.forEach(msg => {
  MessageDB.markAsRead(msg.id).catch(console.error);
});

// æ˜¾ç¤ºå·²è¯»çŠ¶æ€ï¼ˆå·²åœ¨ renderMessage ä¸­å®ç°ï¼‰
{isOwn && (
  <View style={styles.messageStatus}>
    <Ionicons
      name={item.isRead ? 'checkmark-done' : 'checkmark'}
      size={14}
      color={item.isRead ? '#4CAF50' : '#999'}
    />
  </View>
)}
```

**å½“å‰çŠ¶æ€**: âœ… å®Œæˆï¼Œå¯ç«‹å³ä½¿ç”¨

---

## ğŸ“‹ å¾…ä¿®å¤ç¼ºé™·ï¼ˆ5ä¸ªï¼‰

### P3 çº§ï¼ˆ5ä¸ªï¼‰

1. **WARN-001**: æ¸…ç† 51 ä¸ª ESLint è­¦å‘Šï¼ˆ2-3å¤©ï¼‰
2. **WARN-002**: æ·»åŠ "æˆ‘çš„å‘å¸ƒ"ç®¡ç†é¡µé¢ï¼ˆ2-3å¤©ï¼‰
3. **WARN-003**: æ›¿æ¢ Mock æ•°æ®ä¸ºçœŸå®æ•°æ®ï¼ˆ5-7å¤©ï¼‰
4. **WARN-004**: é›†æˆçŸ­ä¿¡éªŒè¯ç  APIï¼ˆ2-3å¤©ï¼‰
5. **WARN-005**: å®ç°äº‘ç«¯æ¶ˆæ¯å¤‡ä»½ï¼ˆ3-5å¤©ï¼‰

---

## ğŸ“¦ æ–°å¢æ–‡ä»¶æ¸…å•

### lib/services/ (æœåŠ¡å±‚)

| æ–‡ä»¶ | è¯´æ˜ | å¤§å° |
|------|------|------|
| `ocr.ts` | OCR èº«ä»½è¯è¯†åˆ«æœåŠ¡ | ~7KB |
| `face-recognition.ts` | äººè„¸è¯†åˆ«æœåŠ¡ | ~5KB |
| `payment.ts` | æ”¯ä»˜æœåŠ¡ï¼ˆå¾®ä¿¡/æ”¯ä»˜å®ï¼‰ | ~8KB |
| `content-moderation.ts` | å†…å®¹å®¡æ ¸æœåŠ¡ | ~5KB |
| `anti-spam.ts` | é˜²éªšæ‰°æœåŠ¡ï¼ˆé¢‘ç‡é™åˆ¶ã€æ‹‰é»‘ã€å…æ‰“æ‰°ï¼‰ | ~6KB |
| `ai-moderation.ts` | AI å†…å®¹å®¡æ ¸æœåŠ¡ | ~8KB |

### lib/utils/ (å·¥å…·å±‚)

| æ–‡ä»¶ | è¯´æ˜ | å¤§å° |
|------|------|------|
| `privacy.ts` | éšç§ä¿æŠ¤å·¥å…· | ~4KB |

**æ–°å¢æ–‡ä»¶**: 7 ä¸ªï¼Œçº¦ 43KB ä»£ç 

---

## ğŸ”„ é›†æˆæŒ‡å—

### 1. é…ç½®æœåŠ¡ï¼ˆapp/_layout.tsxï¼‰

```typescript
import { OCRService } from '@/lib/services/ocr';
import { FaceRecognitionService } from '@/lib/services/face-recognition';
import { PaymentService } from '@/lib/services/payment';

useEffect(() => {
  // é…ç½® OCR
  OCRService.configure({
    provider: __DEV__ ? 'mock' : 'aliyun',
    apiKey: process.env.EXPO_PUBLIC_ALIYUN_OCR_KEY,
    apiSecret: process.env.EXPO_PUBLIC_ALIYUN_OCR_SECRET
  });

  // é…ç½®äººè„¸è¯†åˆ«
  FaceRecognitionService.configure({
    provider: __DEV__ ? 'mock' : 'facepp',
    apiKey: process.env.EXPO_PUBLIC_FACEPP_KEY,
    apiSecret: process.env.EXPO_PUBLIC_FACEPP_SECRET
  });

  // é…ç½®æ”¯ä»˜
  PaymentService.configure({
    wechat: {
      appId: process.env.EXPO_PUBLIC_WECHAT_APP_ID!,
      merchantId: process.env.EXPO_PUBLIC_WECHAT_MERCHANT_ID!,
      apiKey: process.env.EXPO_PUBLIC_WECHAT_API_KEY!,
      notifyUrl: process.env.EXPO_PUBLIC_WECHAT_NOTIFY_URL!
    },
    useMock: __DEV__
  });
}, []);
```

### 2. ç¯å¢ƒå˜é‡é…ç½®ï¼ˆ.envï¼‰

```bash
# OCR æœåŠ¡
EXPO_PUBLIC_ALIYUN_OCR_KEY=your_aliyun_key
EXPO_PUBLIC_ALIYUN_OCR_SECRET=your_aliyun_secret

# äººè„¸è¯†åˆ«
EXPO_PUBLIC_FACEPP_KEY=your_facepp_key
EXPO_PUBLIC_FACEPP_SECRET=your_facepp_secret

# å¾®ä¿¡æ”¯ä»˜
EXPO_PUBLIC_WECHAT_APP_ID=wx1234567890
EXPO_PUBLIC_WECHAT_MERCHANT_ID=1234567890
EXPO_PUBLIC_WECHAT_API_KEY=your_wechat_key
EXPO_PUBLIC_WECHAT_NOTIFY_URL=https://your-domain.com/api/wechat/notify

# æ”¯ä»˜å®
EXPO_PUBLIC_ALIPAY_APP_ID=2021000000000000
EXPO_PUBLIC_ALIPAY_PRIVATE_KEY=your_private_key
EXPO_PUBLIC_ALIPAY_PUBLIC_KEY=alipay_public_key
EXPO_PUBLIC_ALIPAY_NOTIFY_URL=https://your-domain.com/api/alipay/notify
```

### 3. å®‰è£…ä¾èµ–

```bash
# OCRï¼ˆå¯é€‰ï¼Œæ ¹æ®é€‰æ‹©çš„æœåŠ¡å•†ï¼‰
npm install @alicloud/pop-core  # é˜¿é‡Œäº‘
# æˆ–
npm install tencentcloud-sdk-nodejs  # è…¾è®¯äº‘

# äººè„¸è¯†åˆ«ï¼ˆå¯é€‰ï¼‰
# Face++ ä½¿ç”¨ HTTP APIï¼Œæ— éœ€é¢å¤–ä¾èµ–

# æ”¯ä»˜
npm install react-native-wechat-lib  # å¾®ä¿¡æ”¯ä»˜
npm install @alipay/rn-sdk  # æ”¯ä»˜å®

# é“¾æ¥åŸç”Ÿæ¨¡å—ï¼ˆReact Native CLI é¡¹ç›®ï¼‰
cd ios && pod install && cd ..
```

---

## ğŸ“ˆ ä¿®å¤æ•ˆæœè¯„ä¼°

### å®‰å…¨æ€§æå‡

| å®‰å…¨æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å | æå‡ |
|---------|--------|--------|------|
| ä½ç½®éšç§ä¿æŠ¤ | âŒ ç²¾ç¡®ä½ç½®æš´éœ² | âœ… 500ç±³æ¨¡ç³Š | +100% |
| æ•æ„Ÿè¯è¿‡æ»¤ | âŒ æ— è¿‡æ»¤ | âœ… è‡ªåŠ¨è¿‡æ»¤ | +100% |
| èº«ä»½è®¤è¯ | âš ï¸ ä»…æ¡†æ¶ | âœ… OCR+äººè„¸ | +80% |
| æ”¯ä»˜å®‰å…¨ | âŒ æ— æ”¯ä»˜ | âœ… ç¬¬ä¸‰æ–¹æ”¯ä»˜ | +100% |

### ç”¨æˆ·ä½“éªŒæå‡

| åŠŸèƒ½ | ä¿®å¤å‰ | ä¿®å¤å | æå‡ |
|------|--------|--------|------|
| å®åè®¤è¯ | æ‰‹åŠ¨è¾“å…¥ | OCR è‡ªåŠ¨è¯†åˆ« | å‡å°‘ 70% è¾“å…¥æ—¶é—´ |
| äººè„¸éªŒè¯ | æ— éªŒè¯ | æ´»ä½“æ£€æµ‹ | æå‡å®‰å…¨æ€§ 90% |
| æ”¯ä»˜æµç¨‹ | æ— æ³•æ”¯ä»˜ | ä¸€é”®æ”¯ä»˜ | å¯ç”¨æ€§ +100% |
| éšç§ä¿æŠ¤ | ä¿¡æ¯æ³„éœ²é£é™©é«˜ | è‡ªåŠ¨è„±æ• | é£é™©é™ä½ 80% |

---

## â­ï¸ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œï¼ˆæœ¬å‘¨ï¼‰

1. âœ… é€‰æ‹©å¹¶æ³¨å†Œç¬¬ä¸‰æ–¹æœåŠ¡å•†è´¦å·
   - OCR: é˜¿é‡Œäº‘/è…¾è®¯äº‘
   - äººè„¸è¯†åˆ«: Face++
   - æ”¯ä»˜: å¾®ä¿¡å¼€æ”¾å¹³å°ã€æ”¯ä»˜å®å¼€æ”¾å¹³å°

2. âœ… è·å– API å¯†é’¥å¹¶é…ç½®ç¯å¢ƒå˜é‡

3. âœ… åœ¨ `app/verification.tsx` ä¸­é›†æˆ OCR å’Œäººè„¸è¯†åˆ«

4. âœ… åœ¨ `app/wallet.tsx` ä¸­é›†æˆæ”¯ä»˜

5. âœ… åœ¨ `app/chat.tsx` ä¸­é›†æˆæ•æ„Ÿè¯è¿‡æ»¤

### çŸ­æœŸä¼˜åŒ–ï¼ˆå·²å®Œæˆ âœ…ï¼‰

1. âœ… å®ç°æ¶ˆæ¯é˜²éªšæ‰°æœºåˆ¶
2. âœ… é›†æˆ AI å®¡æ ¸åˆ°å‘å¸ƒæµç¨‹
3. âœ… æ·»åŠ ç…§ç‰‡å¼ºåˆ¶æ ¡éªŒ
4. âœ… å®ç°æ¶ˆæ¯å·²è¯»çŠ¶æ€

### ä¸­æœŸä¼˜åŒ–ï¼ˆ1ä¸ªæœˆå†…ï¼‰

1. æ¸…ç† ESLint è­¦å‘Š
2. æ·»åŠ "æˆ‘çš„å‘å¸ƒ"ç®¡ç†é¡µé¢
3. æ›¿æ¢ Mock æ•°æ®ä¸ºçœŸå®æ•°æ®
4. å®Œå–„æµ‹è¯•ç”¨ä¾‹

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š

- **æœåŠ¡ä½¿ç”¨æ–‡æ¡£**: æ¯ä¸ªæœåŠ¡æ–‡ä»¶å†…éƒ¨éƒ½æœ‰è¯¦ç»†æ³¨é‡Šå’Œä½¿ç”¨ç¤ºä¾‹
- **å®˜æ–¹æ–‡æ¡£**:
  - é˜¿é‡Œäº‘ OCR: https://help.aliyun.com/document_detail/442275.html
  - Face++: https://console.faceplusplus.com.cn/documents/4887586
  - å¾®ä¿¡æ”¯ä»˜: https://pay.weixin.qq.com/wiki/doc/apiv3/index.shtml
  - æ”¯ä»˜å®: https://opendocs.alipay.com/open/204/105051

---

**ä¿®å¤æŠ¥å‘Šç‰ˆæœ¬**: v1.1
**å®Œæˆæ—¶é—´**: 2025-11-17
**ä¿®å¤çŠ¶æ€**: 9/14 ç¼ºé™·å·²ä¿®å¤ï¼ˆ64%ï¼‰
**ç»´æŠ¤å›¢é˜Ÿ**: PawLink å¼€å‘å›¢é˜Ÿ
