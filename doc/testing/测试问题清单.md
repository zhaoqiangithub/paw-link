# PawLink 测试问题清单

**生成日期**: 2025-11-17
**测试版本**: MVP v1.0 (feature/mvp-iteration-1)
**优先级定义**:
- **P0**: 阻塞性缺陷，必须修复才能上线
- **P1**: 严重缺陷，强烈建议修复
- **P2**: 一般缺陷，建议修复
- **P3**: 优化建议，可后续迭代

---

## 🔴 P0 级缺陷（3个）- 必须修复

### BUG-001: OCR API 未集成
- **模块**: 用户认证 > 实名认证
- **文件**: `app/verification.tsx:164`
- **问题描述**: 身份证 OCR 识别仅有 TODO 标记，无实际 API 调用
- **影响**: 用户需手动输入身份证信息，无法自动识别，体验差
- **复现步骤**:
  1. 进入实名认证页面
  2. 上传身份证照片
  3. 信息未自动填充
- **预期行为**: 上传照片后自动识别并填充姓名、身份证号
- **建议方案**:
  - 方案1: 集成第三方 OCR API（如阿里云、腾讯云）
  - 方案2: 短期内提供手动输入作为降级方案
- **修复工作量**: 3-5天
- **相关测试用例**: TC-AUTH-001

```typescript
// 问题代码位置
// app/verification.tsx:164
try {
  // TODO: 调用OCR API识别身份证信息
  Alert.alert('上传成功', '身份证照片已上传');
} catch (error) {
  // ...
}
```

---

### BUG-002: 人脸识别 API 未集成
- **模块**: 用户认证 > 实名认证
- **文件**: `app/verification.tsx:249`
- **问题描述**: 人脸识别仅有 UI 界面，无实际 API 调用
- **影响**: 无法验证用户身份真实性，存在安全风险
- **复现步骤**:
  1. 进入人脸识别验证页面
  2. 点击"开始验证"
  3. 仅显示 UI，无实际验证逻辑
- **预期行为**: 调用人脸识别 API，对比身份证照片和实时人脸
- **建议方案**:
  - 方案1: 集成第三方人脸识别 API（如Face++、腾讯云）
  - 方案2: 短期内采用人工审核替代
- **修复工作量**: 5-7天（含对接测试）
- **安全等级**: 高
- **相关测试用例**: TC-AUTH-001, TC-AUTH-003

```typescript
// 问题代码位置
// app/verification.tsx:249
const handleCapture = async () => {
  // TODO: 调用人脸识别API进行验证
  Alert.alert('提示', '人脸识别功能开发中');
};
```

---

### BUG-009: 支付 API 未集成
- **模块**: 支付众筹 > 捐赠支付
- **文件**: `app/wallet.tsx:71`, `app/wallet.tsx:94`
- **问题描述**: 充值和提现功能仅有 TODO 标记，无支付 API 调用
- **影响**: 无法完成捐赠、众筹等核心业务流程
- **复现步骤**:
  1. 进入钱包页面
  2. 点击"充值"或"提现"
  3. 仅显示提示信息，无实际支付流程
- **预期行为**: 调用微信支付/支付宝 API 完成支付
- **建议方案**:
  - 集成微信支付 SDK
  - 集成支付宝 SDK
  - 后端提供统一支付网关
- **修复工作量**: 7-10天（含前后端联调）
- **依赖**: 需要后端支持
- **相关测试用例**: TC-PAY-002, TC-PAY-003, TC-PAY-005

```typescript
// 问题代码位置
// app/wallet.tsx:71
const handleRecharge = async (amount: number) => {
  // TODO: 调用支付API
  Alert.alert('提示', '充值功能开发中');
};

// app/wallet.tsx:94
const handleWithdraw = async (amount: number) => {
  // TODO: 调用支付API
  Alert.alert('提示', '提现功能开发中');
};
```

---

## 🟠 P1 级缺陷（4个）- 强烈建议修复

### BUG-004: AI 审核未集成到发布流程
- **模块**: 信息发布 > AI 辅助审核
- **文件**: `app/ai-moderation.tsx` 存在但未使用
- **问题描述**: AI 审核模块代码存在，但未集成到发布流程中
- **影响**: 无法自动检测重复信息、虚假信息，增加人工审核成本
- **复现步骤**:
  1. 发布宠物信息
  2. 发布相同/相似信息
  3. 无任何提示或拦截
- **预期行为**: 发布前自动检测重复/虚假信息，提示用户
- **建议方案**:
  - 在 `app/publish.tsx` 提交前调用 AI 审核逻辑
  - 实现图片相似度检测（图片 hash 比对）
  - 实现位置相似度检测（地理距离计算）
- **修复工作量**: 3-5天
- **相关测试用例**: TC-MAP-007

```typescript
// 建议集成点
// app/publish.tsx:250 (handleSubmit 函数)
const handleSubmit = async () => {
  // 1. 表单校验
  if (!validateForm()) return;

  // 2. AI 审核（建议添加）
  // const moderationResult = await AIModerationService.check(formData);
  // if (!moderationResult.passed) {
  //   Alert.alert('提示', moderationResult.message);
  //   return;
  // }

  // 3. 提交数据库
  // ...
};
```

---

### BUG-005: 位置信息未脱敏
- **模块**: 隐私保护 > 位置信息
- **文件**: `components/MapView.tsx`, `lib/database.ts`
- **问题描述**: 宠物信息直接显示精确经纬度，无模糊处理
- **影响**: 隐私泄露风险，用户家庭住址可能暴露
- **安全等级**: 高
- **复现步骤**:
  1. 发布宠物信息（含精确位置）
  2. 其他用户查看地图
  3. 可看到精确坐标点
- **预期行为**:
  - 公开展示: 模糊位置（误差 500米）
  - 详细地址: 仅联系后双方可见
- **建议方案**:
  ```typescript
  // 添加位置模糊化函数
  function fuzzyLocation(lat: number, lon: number, radius: number = 500) {
    const randomAngle = Math.random() * 2 * Math.PI;
    const randomDistance = Math.random() * radius;
    const deltaLat = randomDistance * Math.cos(randomAngle) / 111000;
    const deltaLon = randomDistance * Math.sin(randomAngle) / (111000 * Math.cos(lat * Math.PI / 180));
    return {
      latitude: lat + deltaLat,
      longitude: lon + deltaLon
    };
  }
  ```
- **修复工作量**: 2-3天
- **相关测试用例**: TC-MAP-009

---

### BUG-007: 敏感词过滤缺失
- **模块**: 消息系统 > 内容安全
- **文件**: `app/chat.tsx`
- **问题描述**: 消息发送无敏感词过滤，存在内容安全风险
- **影响**: 可能出现辱骂、违法内容，影响平台合规性
- **安全等级**: 高
- **复现步骤**:
  1. 进入聊天界面
  2. 发送任意内容（包括敏感词）
  3. 消息正常发送，无拦截
- **预期行为**: 检测敏感词，自动过滤或拦截发送
- **建议方案**:
  - 方案1: 集成第三方内容安全 API（阿里云、腾讯云）
  - 方案2: 本地敏感词库（需定期更新）
  ```typescript
  // 建议添加
  const filterSensitiveWords = (text: string): { filtered: string, hasSensitive: boolean } => {
    // 敏感词检测逻辑
    // ...
    return { filtered: text, hasSensitive: false };
  };

  const handleSend = async () => {
    const { filtered, hasSensitive } = filterSensitiveWords(inputMessage);
    if (hasSensitive) {
      Alert.alert('提示', '消息包含敏感词，请修改后重新发送');
      return;
    }
    // 继续发送...
  };
  ```
- **修复工作量**: 3-5天
- **相关测试用例**: TC-CHAT-005

---

### BUG-008: 消息防骚扰机制缺失
- **模块**: 消息系统 > 防骚扰
- **文件**: `app/chat.tsx`
- **问题描述**: 无频率限制、拉黑、免打扰功能
- **影响**: 用户可能遭受恶意骚扰，体验差
- **复现步骤**:
  1. 快速连续发送多条消息（>10条/分钟）
  2. 无任何限制或提示
- **预期行为**:
  - 频率限制: 1分钟最多10条消息
  - 拉黑功能: 被拉黑用户无法发送消息
  - 免打扰功能: 不接收特定用户消息
- **建议方案**:
  ```typescript
  // 添加频率限制
  const messageCounts = new Map<string, { count: number, timestamp: number }>();

  const checkRateLimit = (userId: string): boolean => {
    const now = Date.now();
    const record = messageCounts.get(userId);

    if (!record || now - record.timestamp > 60000) {
      messageCounts.set(userId, { count: 1, timestamp: now });
      return true;
    }

    if (record.count >= 10) {
      return false; // 超过限制
    }

    record.count++;
    return true;
  };
  ```
- **修复工作量**: 3-5天
- **数据库改动**: 需添加 `user_blacklist`, `user_mute_settings` 表
- **相关测试用例**: TC-CHAT-006

---

## 🟡 P2 级缺陷（2个）- 建议修复

### BUG-003: 照片上传未强制至少1张
- **模块**: 信息发布 > 必填项校验
- **文件**: `app/publish.tsx:217-248`
- **问题描述**: 发布宠物信息时，照片上传虽有功能，但未强制要求至少1张
- **影响**: 信息质量下降，无图片的信息说服力低
- **复现步骤**:
  1. 进入发布页面
  2. 填写所有必填项，但不上传照片
  3. 可正常提交
- **预期行为**: 至少上传1张照片才能提交
- **建议修复**:
  ```typescript
  // app/publish.tsx:217
  const validateForm = () => {
    // ... 其他校验

    // 添加照片数量校验
    if (formData.images.length < 1) {
      Alert.alert('提示', '请至少上传1张照片');
      return false;
    }

    return true;
  };
  ```
- **修复工作量**: 0.5天
- **相关测试用例**: TC-MAP-005

---

### BUG-006: 消息已读/未读状态未实现
- **模块**: 消息系统 > 消息状态
- **文件**: `app/chat.tsx`
- **问题描述**: 数据库有 `isRead` 字段，但 UI 未显示已读/未读状态
- **影响**: 用户无法知道消息是否被阅读，体验欠佳
- **复现步骤**:
  1. 发送消息给其他用户
  2. 对方查看消息
  3. 发送者无法看到"已读"状态
- **预期行为**: 消息显示"已送达"、"已读"状态
- **建议方案**:
  ```typescript
  // 添加已读状态显示
  <Text style={{ fontSize: 12, color: Colors.textSecondary }}>
    {item.isRead ? '已读' : '未读'}
  </Text>

  // 添加已读更新逻辑
  useEffect(() => {
    const markAsRead = async () => {
      // 更新数据库 isRead 字段
      await MessageDB.markAsRead(messageId);
    };
    markAsRead();
  }, [messages]);
  ```
- **修复工作量**: 1-2天
- **相关测试用例**: TC-CHAT-002

---

## 🔵 P3 级问题（5个）- 优化建议

### WARN-001: 51个 ESLint 警告
- **文件**: 多个文件
- **问题分类**:
  - 未使用的变量: 35个
  - 缺少依赖项（useEffect）: 9个
  - 未使用的导入: 7个
- **影响**: 代码质量，可能隐藏潜在 bug
- **建议**: 逐一清理，修复 useEffect 依赖项警告
- **修复工作量**: 2-3天

**重点文件**:
1. `app/verification.tsx`: 13个警告
2. `components/AmapWebView.tsx`: 8个警告
3. `app/crowdfunding.tsx`: 4个警告

---

### WARN-002: "我的发布"管理页面缺失
- **问题描述**: 用户无法查看和管理自己发布的宠物信息
- **影响**: 无法更新状态（如标记为"已领养"）
- **建议**: 添加 `app/my-posts.tsx` 页面
- **功能需求**:
  - 显示所有已发布信息
  - 支持编辑、删除、更新状态
  - 查看统计数据（浏览量、联系量）
- **修复工作量**: 2-3天
- **相关测试用例**: TC-MAP-008

---

### WARN-003: 大量 Mock 数据
- **文件**:
  - `app/volunteer.tsx`: 志愿者活动数据
  - `app/crowdfunding.tsx`: 众筹项目数据
  - `app/points-mall.tsx`: 积分商城商品数据
- **问题描述**: 使用静态 Mock 数据，非真实数据源
- **影响**: 无法动态管理，需要后端支持
- **建议**: 逐步替换为数据库查询或 API 调用
- **修复工作量**: 5-7天

---

### WARN-004: 短信验证码 API 未集成
- **文件**: `app/verification.tsx:325`
- **问题描述**: 手机号验证功能仅有 TODO 标记
- **影响**: 无法验证手机号真实性
- **建议**: 集成短信服务（阿里云、腾讯云）
- **修复工作量**: 2-3天
- **依赖**: 需要短信服务账号和后端支持

---

### WARN-005: 云端消息备份未实现
- **文件**: 消息系统
- **问题描述**: 消息仅本地 SQLite 存储，无云端备份
- **影响**: 更换设备或重装应用后，聊天记录丢失
- **建议**: 实现云端备份功能
- **修复工作量**: 3-5天
- **依赖**: 需要后端数据库支持

---

## 📊 问题统计

| 优先级 | 数量 | 修复工作量（估算） | 建议修复时间 |
|--------|------|------------------|-------------|
| P0 | 3 | 15-22天 | 立即修复 |
| P1 | 4 | 12-18天 | 1-2周内修复 |
| P2 | 2 | 1.5-3天 | 1个月内修复 |
| P3 | 5 | 14-21天 | 持续优化 |
| **总计** | **14** | **42.5-64天** | - |

---

## 🎯 修复优先级建议

### 第一阶段（必须，2-3周）
**目标**: 修复所有 P0 缺陷，确保核心流程可用

1. ✅ BUG-009: 集成支付 API（7-10天）
2. ✅ BUG-001: 集成 OCR API 或提供降级方案（3-5天）
3. ✅ BUG-002: 集成人脸识别 API 或人工审核（5-7天）

**完成标准**: 用户可完成实名认证和捐赠支付

---

### 第二阶段（重要，1-2周）
**目标**: 修复 P1 缺陷，提升安全性和用户体验

1. ✅ BUG-005: 位置信息脱敏（2-3天）
2. ✅ BUG-007: 敏感词过滤（3-5天）
3. ✅ BUG-008: 防骚扰机制（3-5天）
4. ✅ BUG-004: AI 审核集成（3-5天）

**完成标准**: 平台安全性达标，用户体验良好

---

### 第三阶段（优化，1个月）
**目标**: 修复 P2 和部分 P3 问题

1. ✅ BUG-003: 照片强制校验（0.5天）
2. ✅ BUG-006: 消息已读状态（1-2天）
3. ✅ WARN-001: 清理 ESLint 警告（2-3天）
4. ✅ WARN-002: "我的发布"页面（2-3天）

**完成标准**: 功能完善，代码质量提升

---

### 第四阶段（持续优化）
**目标**: 完善所有 P3 问题

1. ✅ WARN-003: 替换 Mock 数据（5-7天）
2. ✅ WARN-004: 短信验证码集成（2-3天）
3. ✅ WARN-005: 云端消息备份（3-5天）

**完成标准**: 产品成熟度达到 90%+

---

## 📋 修复跟踪表（模板）

| 缺陷编号 | 优先级 | 负责人 | 计划开始日期 | 计划完成日期 | 实际完成日期 | 状态 | 备注 |
|---------|--------|--------|-------------|-------------|-------------|------|------|
| BUG-009 | P0 | - | - | - | - | 待修复 | |
| BUG-001 | P0 | - | - | - | - | 待修复 | |
| BUG-002 | P0 | - | - | - | - | 待修复 | |
| BUG-005 | P1 | - | - | - | - | 待修复 | |
| BUG-007 | P1 | - | - | - | - | 待修复 | |
| BUG-008 | P1 | - | - | - | - | 待修复 | |
| BUG-004 | P1 | - | - | - | - | 待修复 | |
| BUG-003 | P2 | - | - | - | - | 待修复 | |
| BUG-006 | P2 | - | - | - | - | 待修复 | |

---

## 📞 联系方式

如有疑问，请联系测试团队：
- **邮箱**: test-team@pawlink.app
- **Slack**: #pawlink-testing
- **项目地址**: /Users/zhaoqiang/Projects/paw-link

---

**文档版本**: v1.0
**最后更新**: 2025-11-17
**下次更新**: 根据修复进度更新
