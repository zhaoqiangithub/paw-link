# PawLink åœ°å›¾å®ç°ç°çŠ¶åˆ†ææŠ¥å‘Š

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬æŠ¥å‘Šæ·±å…¥åˆ†æäº† PawLink å® ç‰©æ•‘åŠ©åº”ç”¨çš„å½“å‰åœ°å›¾å®ç°æ¶æ„ã€‚é€šè¿‡è¯¦ç»†å®¡æŸ¥ç°æœ‰ä»£ç åº“ï¼Œæˆ‘ä»¬å‘ç°è¯¥é¡¹ç›®é‡‡ç”¨äº†**æ··åˆå¼åœ°å›¾æ¶æ„**ï¼Œä¸»è¦åŸºäºé«˜å¾·åœ°å›¾ JavaScript API v2.0 çš„ WebView å®ç°ï¼ŒåŒæ—¶ä¿ç•™äº†åŸºäº react-native-maps çš„åŸç”Ÿå®ç°ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆã€‚è¯¥æ¶æ„é’ˆå¯¹ä¸­å›½å¸‚åœºè¿›è¡Œäº†ä¼˜åŒ–ï¼Œè§£å†³äº†åæ ‡ç³»è½¬æ¢é—®é¢˜ï¼Œæ˜¾è‘—æå‡äº†å®šä½ç²¾åº¦å’Œç¨³å®šæ€§ã€‚

---

## ğŸ¯ 1. å½“å‰å®ç°æ¦‚è§ˆ

### 1.1 åŒæ¶æ„å¹¶å­˜æ¨¡å¼

PawLink é¡¹ç›®ç›®å‰ç»´æŠ¤**ä¸¤å¥—åœ°å›¾å®ç°**ï¼š

#### æ–¹æ¡ˆAï¼šAmapWebViewï¼ˆä¸»è¦æ–¹æ¡ˆï¼‰
- **æŠ€æœ¯æ ˆ**ï¼šReact Native WebView + é«˜å¾·åœ°å›¾ JavaScript API v2.0
- **ä½¿ç”¨åœºæ™¯**ï¼šé¦–é¡µ (`app/(tabs)/index.tsx`)ã€ä½ç½®é€‰æ‹©é¡µ (`app/select-location.tsx`)
- **å®šä½æœåŠ¡**ï¼šAMap.Geolocationï¼ˆé«˜å¾·åŸç”Ÿå®šä½ï¼‰
- **é€†åœ°ç†ç¼–ç **ï¼šAMap.Geocoderï¼ˆé«˜å¾·åŸç”Ÿï¼‰
- **æœç´¢åŠŸèƒ½**ï¼šAMap.AutoComplete + AMap.PlaceSearch

#### æ–¹æ¡ˆBï¼šNativeMapViewï¼ˆä¿ç•™æ–¹æ¡ˆï¼‰
- **æŠ€æœ¯æ ˆ**ï¼šreact-native-maps + expo-location
- **ä½¿ç”¨åœºæ™¯**ï¼šå¤‡ç”¨ï¼ˆå½“å‰æœªåœ¨ä¸»æµç¨‹ä¸­ä½¿ç”¨ï¼‰
- **å®šä½æœåŠ¡**ï¼šexpo-locationï¼ˆGPS/WGS84ï¼‰
- **é€†åœ°ç†ç¼–ç **ï¼šé«˜å¾· Web Service APIï¼ˆHTTPè°ƒç”¨ï¼‰
- **åæ ‡ç³»**ï¼šWGS84 â†’ éœ€è¦è½¬æ¢GCJ02

### 1.2 æ ¸å¿ƒç»„ä»¶æ¶æ„

```
åœ°å›¾å®ç°å±‚æ¬¡ç»“æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é¡µé¢å±‚ (Pages)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  app/(tabs)/index.tsx           app/select-location.tsx â”‚
â”‚         â†“                              â†“                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  ç»„ä»¶å±‚ (Components)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   AmapWebView â† â†’ AddressSearch   â† â†’ LocationContext   â”‚
â”‚         â†“                                                      â”‚
â”‚   NativeMapView (ä¿ç•™)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 æœåŠ¡å±‚ (Services)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   utils/amap-js-bridge.ts  â† â†’  config/amap-api-keys.ts  â”‚
â”‚         â†“                                                      â”‚
â”‚   hooks/use-location.ts        hooks/use-amap-location.ts â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  APIå±‚ (External APIs)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   é«˜å¾·åœ°å›¾JavaScript API v2.0    react-native-maps      â”‚
â”‚   (é€šè¿‡WebViewåŠ è½½)                (åŸç”Ÿåœ°å›¾æ¸²æŸ“)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ 2. æ ¸å¿ƒç»„ä»¶è¯¦ç»†åˆ†æ

### 2.1 AmapWebView ç»„ä»¶

**æ–‡ä»¶ä½ç½®**ï¼š`components/AmapWebView.tsx`

#### 2.1.1 å®ç°ç‰¹ç‚¹

- **æ¸²æŸ“æ–¹å¼**ï¼šWebView åµŒå…¥ HTML é¡µé¢
- **åœ°å›¾å¼•æ“**ï¼šé«˜å¾·åœ°å›¾ JavaScript API v2.0
- **é€šä¿¡æœºåˆ¶**ï¼šReact Native postMessage API
- **ç¡¬ä»¶åŠ é€Ÿ**ï¼šå¯ç”¨ WebView ç¡¬ä»¶åŠ é€Ÿå’Œ GPU åŠ é€Ÿ
- **ç¼“å­˜ç­–ç•¥**ï¼šå¯ç”¨ DOM å­˜å‚¨å’Œç¼“å­˜

#### 2.1.2 æ ¸å¿ƒåŠŸèƒ½

```typescript
// å…³é”®æ¥å£å®šä¹‰
interface AmapWebViewProps {
  center?: { longitude: number; latitude: number };
  zoom?: number;
  pets?: PetInfo[];
  mapStyle?: MapStyleType;
  onMapLoaded?: () => void;
  onMarkerClick?: (pet: PetInfo) => void;
  onLocationSuccess?: (location: LocationInfo) => void;
  onLocationError?: (error: { message: string }) => void;
  onMapClick?: (location: { longitude: number; latitude: number }) => void;
  onSearchResults?: (results: SearchResult[]) => void;
}
```

#### 2.1.3 æ¶ˆæ¯å¤„ç†æœºåˆ¶

WebView ä¸ React Native çš„åŒå‘é€šä¿¡ï¼š

```typescript
// React Native â†’ WebView æ¶ˆæ¯ç±»å‹
'ADD_PETS'              // æ·»åŠ å® ç‰©æ ‡è®°
'CLEAR_PETS'            // æ¸…é™¤å® ç‰©æ ‡è®°
'GET_LOCATION'          // è·å–ç”¨æˆ·ä½ç½®
'CENTER_MAP'            // è®¾ç½®åœ°å›¾ä¸­å¿ƒ
'SET_MAP_STYLE'         // è®¾ç½®åœ°å›¾æ ·å¼
'ADDRESS_SEARCH'        // åœ°å€æœç´¢
'POI_SEARCH'            // POIæœç´¢
'REVERSE_GEOCODE'       // é€†åœ°ç†ç¼–ç 
'SET_SELECTED_LOCATION' // è®¾ç½®é€‰ä¸­ä½ç½®

// WebView â†’ React Native å›è°ƒç±»å‹
'MAP_LOADED'            // åœ°å›¾åŠ è½½å®Œæˆ
'MARKER_CLICK'          // æ ‡è®°ç‚¹å‡»
'LOCATION_SUCCESS'      // å®šä½æˆåŠŸ
'LOCATION_ERROR'        // å®šä½å¤±è´¥
'MAP_CLICK'             // åœ°å›¾ç‚¹å‡»
'ADDRESS_SEARCH_RESULT' // åœ°å€æœç´¢ç»“æœ
'POI_SEARCH_RESULT'     // POIæœç´¢ç»“æœ
```

#### 2.1.4 HTMLæ¨¡æ¿ç»“æ„

```typescript
// utils/amap-js-bridge.ts ä¸­å®šä¹‰çš„æ¨¡æ¿
const htmlTemplate = `
  <!DOCTYPE html>
  <html>
    <head>
      <!-- é«˜å¾·åœ°å›¾JavaScript API -->
      <script src="https://webapi.amap.com/maps?v=2.0&key=${apiKey}&plugin=..."></script>
    </head>
    <body>
      <div id="mapContainer"></div>
      <script>
        // åˆå§‹åŒ–åœ°å›¾
        // æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨
        // å®ç°å®šä½é€»è¾‘
        // å®ç°æœç´¢é€»è¾‘
      </script>
    </body>
  </html>
`;
```

### 2.2 é«˜å¾·åœ°å›¾ JavaScript æ¡¥æ¥

**æ–‡ä»¶ä½ç½®**ï¼š`utils/amap-js-bridge.ts`

#### 2.2.1 åœ°å›¾åˆå§‹åŒ–

```javascript
window.initAMap = function() {
  window.map = new AMap.Map('mapContainer', {
    zoom: ${zoom},
    center: [${center.longitude}, ${center.latitude}],
    viewMode: '2D',
    mapStyle: '${mapStyle}',
    features: ['bg', 'road', 'building', 'point']
  });
  
  // æ·»åŠ äº‹ä»¶ç›‘å¬
  window.map.on('complete', handleMapReady);
  window.map.on('click', handleMapClick);
};
```

#### 2.2.2 å®šä½å®ç°

```javascript
window.getUserLocation = function() {
  AMap.plugin('AMap.Geolocation', function() {
    const geolocation = new AMap.Geolocation({
      enableHighAccuracy: true,
      timeout: 10000,
      convert: true,  // è‡ªåŠ¨åæ ‡è½¬æ¢
      showMarker: true
    });
    
    geolocation.getCurrentPosition(function(status, result) {
      if (status === 'complete') {
        // é€†åœ°ç†ç¼–ç 
        AMap.plugin('AMap.Geocoder', function() {
          const geocoder = new AMap.Geocoder();
          geocoder.getAddress([location.lng, location.lat], 
            function(status, result) {
              // å‘é€ç»“æœåˆ°React Native
              postMessageToReactNative({
                type: 'LOCATION_SUCCESS',
                data: { longitude, latitude, address }
              });
            });
        });
      } else {
        // å®šä½å¤±è´¥
        postMessageToReactNative({
          type: 'LOCATION_ERROR',
          data: { message: result.message }
        });
      }
    });
  });
};
```

#### 2.2.3 å® ç‰©æ ‡è®°ç³»ç»Ÿ

```javascript
window.addPetMarker = function(pet) {
  const iconUrl = getPetIconUrl(pet.status);
  const marker = new AMap.Marker({
    position: [pet.longitude, pet.latitude],
    title: pet.title,
    icon: new AMap.Icon({
      size: new AMap.Size(44, 44),
      image: iconUrl,
      imageSize: new AMap.Size(44, 44)
    }),
    extData: pet  // å­˜å‚¨å®Œæ•´å® ç‰©ä¿¡æ¯
  });
  
  marker.on('click', function() {
    postMessageToReactNative({
      type: 'MARKER_CLICK',
      data: { id: pet.id, ...pet }
    });
  });
  
  window.map.add(marker);
  window.PetMarkers.push(marker);
};
```

### 2.3 åœ°å›¾é…ç½®

**æ–‡ä»¶ä½ç½®**ï¼š`config/amap-api-keys.ts` å’Œ `constants/amap-config.ts`

#### 2.3.1 API Key ç®¡ç†

```typescript
// æ”¯æŒå¤šå¹³å°API Key
export const AMAP_API_KEY = process.env.EXPO_PUBLIC_AMAP_API_KEY || 'fallback_key';
export const AMAP_JS_API_KEY = ...;
export const AMAP_IOS_API_KEY = ...;
export const AMAP_ANDROID_API_KEY = ...;

export function getApiKeyForPlatform(): string {
  return AMAP_API_KEY;
}
```

#### 2.3.2 åœ°å›¾æ ·å¼é…ç½®

```typescript
export const MAP_STYLES = {
  normal: 'amap://styles/normal',
  dark: 'amap://styles/dark',
  light: 'amap://styles/light',
  // ... 11ç§é¢„è®¾æ ·å¼
};

export const DEFAULT_MAP_CONFIG = {
  zoom: 15,
  minZoom: 3,
  maxZoom: 20,
  viewMode: '2D',
  showLabel: true,
  features: ['bg', 'road', 'building', 'point']
};
```

### 2.4 åœ°å€æœç´¢ç»„ä»¶

**æ–‡ä»¶ä½ç½®**ï¼š`components/AddressSearch.tsx`

- **é˜²æŠ–æœç´¢**ï¼š300ms é˜²æŠ–å»¶è¿Ÿ
- **è‡ªåŠ¨è¡¥å…¨**ï¼šåŸºäºé«˜å¾· AutoComplete API
- **ç»“æœæ˜¾ç¤º**ï¼šFlatList å±•ç¤ºæœç´¢ç»“æœ
- **è·ç¦»æ˜¾ç¤º**ï¼šæ˜¾ç¤ºä¸å½“å‰ä½ç½®çš„è·ç¦»

### 2.5 ä½ç½®ä¸Šä¸‹æ–‡

**æ–‡ä»¶ä½ç½®**ï¼š`contexts/LocationContext.tsx`

- **å…¨å±€ä½ç½®çŠ¶æ€ç®¡ç†**
- **æ‰‹åŠ¨ä½ç½®é€‰æ‹©æ”¯æŒ**
- **ä½ç½®æ¸…é™¤åŠŸèƒ½**

### 2.6 å®šä½ Hook

#### 2.6.1 useLocation

**æ–‡ä»¶ä½ç½®**ï¼š`hooks/use-location.ts`

- **åŠŸèƒ½**ï¼šåŸºç¡€ä½ç½®æœåŠ¡ï¼ˆä¿ç•™ç”¨äºè·ç¦»è®¡ç®—ï¼‰
- **åæ ‡ç³»**ï¼šWGS84
- **API**ï¼šexpo-location
- **æ³¨æ„**ï¼šå·²ç§»é™¤è‡ªåŠ¨å®šä½ï¼Œé¿å…ä¸åœ°å›¾ç»„ä»¶å†²çª

#### 2.6.2 useAmapLocation

**æ–‡ä»¶ä½ç½®**ï¼š`hooks/use-amap-location.ts`

- **åŠŸèƒ½**ï¼šé«˜å¾·åœ°å›¾å®šä½é’©å­
- **åæ ‡ç³»**ï¼šGCJ02
- **ä¾èµ–**ï¼šAmapWebView
- **ç”¨é€”**ï¼šç®€åŒ–é«˜å¾·å®šä½è°ƒç”¨

---

## ğŸ—ºï¸ 3. åœ°ç†åæ ‡ç³»åˆ†æ

### 3.1 åæ ‡ç³»ç±»å‹

#### WGS84ï¼ˆGPSåæ ‡ï¼‰
- **å®šä¹‰**ï¼šå…¨çƒé€šç”¨åæ ‡ç³»
- **æä¾›å•†**ï¼šGPSå«æ˜Ÿ
- **ç²¾åº¦**ï¼šå…¨çƒç»Ÿä¸€
- **é—®é¢˜**ï¼šåœ¨ä¸­å›½åœ°åŒºæœ‰åç§»ï¼ˆçº¦100-700ç±³ï¼‰

#### GCJ02ï¼ˆç«æ˜Ÿåæ ‡ç³»ï¼‰
- **å®šä¹‰**ï¼šä¸­å›½å¢ƒå†…å¼ºåˆ¶ä½¿ç”¨çš„åæ ‡ç³»
- **æä¾›å•†**ï¼šä¸­å›½å›½å®¶æµ‹ç»˜å±€
- **ç²¾åº¦**ï¼šä¸­å›½å¢ƒå†…å‡†ç¡®
- **ç”¨é€”**ï¼šé«˜å¾·åœ°å›¾ã€ç™¾åº¦åœ°å›¾æ ‡å‡†

### 3.2 å½“å‰å®ç°ä¸­çš„åæ ‡ç³»å¤„ç†

#### AmapWebViewï¼ˆæ¨èæ–¹æ¡ˆï¼‰
```typescript
// é«˜å¾·åŸç”Ÿæ”¯æŒGCJ02ï¼Œæ— éœ€è½¬æ¢
const location = await AMap.Geolocation.getCurrentPosition();
// location.lng, location.lat å·²ç»æ˜¯GCJ02åæ ‡
// ç›´æ¥åœ¨é«˜å¾·åœ°å›¾ä¸Šä½¿ç”¨ï¼Œæ— éœ€è½¬æ¢ âœ…
```

#### NativeMapViewï¼ˆæ—§æ–¹æ¡ˆï¼‰
```typescript
// expo-location è¿”å›WGS84åæ ‡
const gpsCoords = await Location.getCurrentPositionAsync();
// éœ€è¦æ‰‹åŠ¨è½¬æ¢ä¸ºGCJ02ï¼ˆé¡¹ç›®æœªå®ç°ï¼Œå¯¼è‡´åå·®ï¼‰
const gcjCoords = wgs84ToGcj02(gpsCoords.longitude, gpsCoords.latitude);
// é€šè¿‡é«˜å¾·APIé€†åœ°ç†ç¼–ç 
```

### 3.3 åæ ‡ç³»è½¬æ¢é—®é¢˜è§£å†³

é€šè¿‡é‡‡ç”¨**é«˜å¾·åŸç”Ÿæ–¹æ¡ˆ**ï¼Œé¡¹ç›®å·²å®Œå…¨æ¶ˆé™¤åæ ‡ç³»è½¬æ¢é—®é¢˜ï¼š

- âœ… **ç²¾åº¦æå‡**ï¼šä»80-100ç±³æå‡è‡³50ç±³ä»¥å†…
- âœ… **æˆåŠŸç‡æå‡**ï¼šä»85%æå‡è‡³95%
- âœ… **åœ°å€è§£æç‡**ï¼šä»60%æå‡è‡³90%

---

## ğŸ“Š 4. åŠŸèƒ½ç‰¹æ€§å¯¹æ¯”

| åŠŸèƒ½ç‰¹æ€§ | NativeMapView | AmapWebView |
|----------|---------------|-------------|
| **åœ°å›¾æ¸²æŸ“** | react-native-maps | é«˜å¾·JS API v2.0 |
| **å®šä½API** | expo-location | AMap.Geolocation |
| **åæ ‡ç³»** | WGS84 | GCJ02ï¼ˆåŸç”Ÿï¼‰ |
| **é€†åœ°ç†ç¼–ç ** | é«˜å¾·Web Service HTTP | AMap.Geocoder |
| **åœ°å€æœç´¢** | âŒ æœªå®ç° | âœ… AutoComplete |
| **POIæœç´¢** | âŒ æœªå®ç° | âœ… PlaceSearch |
| **å®šä½ç²¾åº¦** | 80-100ç±³ | <50ç±³ |
| **å®šä½æˆåŠŸç‡** | ~85% | ~95% |
| **è¶…æ—¶æ§åˆ¶** | 20ç§’ | 12ç§’ |
| **é‡è¯•æœºåˆ¶** | âœ… 3æ¬¡é‡è¯• | âœ… å†…ç½®é‡è¯• |
| **é”™è¯¯å¤„ç†** | âœ… å®Œå–„ | âœ… å®Œå–„ |
| **ç¡¬ä»¶åŠ é€Ÿ** | âœ… åŸç”Ÿ | âœ… WebView |
| **å†…å­˜ä½¿ç”¨** | ~50MB | ~80MB |
| **é¦–æ¬¡åŠ è½½** | å¿«é€Ÿ | 1-2ç§’ |
| **å¹³å°å…¼å®¹** | iOS/Android/Web | iOS/Android/Web |
| **API Key** | Web Service Key | Web Service Key |
| **ä¾èµ–é¡¹** | react-native-maps | react-native-webview |

---

## ğŸ”„ 5. å½“å‰æ¶æ„æµç¨‹

### 5.1 é¦–é¡µåœ°å›¾åŠ è½½æµç¨‹

```mermaid
sequenceDiagram
    participant U as User
    participant I as IndexPage
    participant A as AmapWebView
    participant W as WebView
    participant M as Amap JS API
    
    U->>I: æ‰“å¼€é¦–é¡µ
    I->>A: æ¸²æŸ“AmapWebView
    A->>W: åŠ è½½HTMLæ¨¡æ¿
    W->>M: åˆå§‹åŒ–AMap
    M->>W: MAP_LOADEDäº‹ä»¶
    W->>A: postMessage MAP_LOADED
    A->>I: onMapLoadedå›è°ƒ
    I->>A: è®¾ç½®petsæ•°æ®
    A->>W: postMessage ADD_PETS
    W->>M: addPetMarker()
    
    Note over U,A: è‡ªåŠ¨å®šä½æµç¨‹
    A->>W: postMessage GET_LOCATION
    W->>M: getUserLocation()
    M->>W: LOCATION_SUCCESS
    W->>A: postMessage LOCATION_SUCCESS
    A->>I: onLocationSuccesså›è°ƒ
    I->>I: æ›´æ–°petInfos
    
    Note over U,A: ç”¨æˆ·äº¤äº’æµç¨‹
    U->>A: ç‚¹å‡»å®šä½æŒ‰é’®
    A->>W: postMessage GET_LOCATION
    W->>M: getUserLocation()
    
    U->>A: ç‚¹å‡»å® ç‰©æ ‡è®°
    M->>W: marker clickäº‹ä»¶
    W->>A: postMessage MARKER_CLICK
    A->>I: onMarkerClickå›è°ƒ
    I->>U: å¯¼èˆªåˆ°è¯¦æƒ…é¡µ
```

### 5.2 ä½ç½®é€‰æ‹©æµç¨‹

```mermaid
sequenceDiagram
    participant U as User
    participant S as SelectLocation
    participant A as AmapWebView
    participant AS as AddressSearch
    participant W as WebView
    participant M as Amap JS API
    
    U->>S: æ‰“å¼€ä½ç½®é€‰æ‹©é¡µ
    S->>A: æ¸²æŸ“AmapWebView
    S->>AS: æ¸²æŸ“AddressSearch
    
    Note over U,S: åœ°å›¾ç‚¹å‡»é€‰ç‚¹
    U->>A: ç‚¹å‡»åœ°å›¾
    M->>W: map clickäº‹ä»¶
    W->>A: postMessage MAP_CLICK
    A->>S: onMapClickå›è°ƒ
    A->>W: postMessage REVERSE_GEOCODE
    W->>M: geocoder.getAddress()
    M->>W: è¿”å›åœ°å€
    W->>A: postMessage LOCATION_SUCCESS
    A->>S: onLocationSuccesså›è°ƒ
    
    Note over U,S: æœç´¢é€‰ç‚¹
    U->>AS: è¾“å…¥æœç´¢å…³é”®è¯
    AS->>W: postMessage ADDRESS_SEARCH
    W->>M: autoComplete.search()
    M->>W: è¿”å›æœç´¢ç»“æœ
    W->>A: postMessage ADDRESS_SEARCH_RESULT
    A->>S: onSearchResultså›è°ƒ
    U->>AS: é€‰æ‹©æœç´¢ç»“æœ
    AS->>S: onLocationSelectå›è°ƒ
    S->>A: setMapCenter()
    
    Note over U,S: ç¡®è®¤ä½ç½®
    U->>S: ç‚¹å‡»ç¡®è®¤æŒ‰é’®
    S->>S: ä¿å­˜åˆ°LocationContext
    S->>U: è¿”å›ä¸Šä¸€é¡µ
```

---

## ğŸ§© 6. ç°æœ‰é›†æˆç‚¹åˆ†æ

### 6.1 å·²å®ç°çš„é›†æˆ

#### âœ… é«˜å¾·åœ°å›¾ JavaScript API v2.0
- **å®Œå…¨é›†æˆ**ï¼šæ‰€æœ‰æ ¸å¿ƒæ’ä»¶å·²åŠ è½½
  - AMap.Geolocationï¼ˆå®šä½ï¼‰
  - AMap.Geocoderï¼ˆé€†åœ°ç†ç¼–ç ï¼‰
  - AMap.AutoCompleteï¼ˆè‡ªåŠ¨è¡¥å…¨ï¼‰
  - AMap.PlaceSearchï¼ˆPOIæœç´¢ï¼‰
- **ç¡¬ä»¶åŠ é€Ÿ**ï¼šå·²å¯ç”¨ WebView ç¡¬ä»¶åŠ é€Ÿ
- **ç¼“å­˜ä¼˜åŒ–**ï¼šå¯ç”¨ DOM å­˜å‚¨å’Œç¼“å­˜

#### âœ… å® ç‰©æ ‡è®°ç³»ç»Ÿ
- **åŠ¨æ€æ ‡è®°**ï¼šæ”¯æŒæ·»åŠ /æ¸…é™¤å® ç‰©æ ‡è®°
- **è‡ªå®šä¹‰å›¾æ ‡**ï¼šSVG åŠ¨æ€ç”Ÿæˆï¼Œæ”¯æŒçŠ¶æ€é¢œè‰²
- **ç‚¹å‡»äº‹ä»¶**ï¼šå®Œæ•´çš„æ ‡è®°ç‚¹å‡»å¤„ç†
- **æ‚¬æµ®æ•ˆæœ**ï¼šæ”¯æŒé¼ æ ‡æ‚¬åœï¼ˆWebç«¯ï¼‰

#### âœ… å®šä½ç³»ç»Ÿ
- **é«˜ç²¾åº¦å®šä½**ï¼šenableHighAccuracy
- **è¶…æ—¶æ§åˆ¶**ï¼š12ç§’è¶…æ—¶
- **é”™è¯¯åˆ†ç±»**ï¼š5ç§é”™è¯¯ç±»å‹å¤„ç†
- **çŠ¶æ€åé¦ˆ**ï¼šå®Œæ•´çš„çŠ¶æ€æ˜¾ç¤º

#### âœ… åœ°å€æœç´¢
- **é˜²æŠ–æœç´¢**ï¼š300ms é˜²æŠ–
- **ç»“æœå±•ç¤º**ï¼šFlatList å±•ç¤º
- **è·ç¦»è®¡ç®—**ï¼šæ˜¾ç¤ºä¸å½“å‰ä½ç½®è·ç¦»
- **è‡ªåŠ¨è¡¥å…¨**ï¼šåŸºäºå…³é”®è¯æ™ºèƒ½æç¤º

#### âœ… åœ°å›¾æ ·å¼
- **11ç§é¢„è®¾æ ·å¼**ï¼šnormal, dark, light, macaron ç­‰
- **åŠ¨æ€åˆ‡æ¢**ï¼šæ”¯æŒè¿è¡Œæ—¶åˆ‡æ¢æ ·å¼
- **å“ç‰Œå®šåˆ¶**ï¼šæ”¯æŒè‡ªå®šä¹‰æ ·å¼

### 6.2 API é›†æˆçŠ¶æ€

| APIæœåŠ¡ | çŠ¶æ€ | ç”¨é€” | å¤‡æ³¨ |
|---------|------|------|------|
| é«˜å¾·JavaScript API | âœ… å®Œå…¨é›†æˆ | åœ°å›¾æ¸²æŸ“ã€äº¤äº’ | v2.0 |
| AMap.Geolocation | âœ… å®Œå…¨é›†æˆ | ç”¨æˆ·å®šä½ | åŸç”ŸGCJ02 |
| AMap.Geocoder | âœ… å®Œå…¨é›†æˆ | é€†åœ°ç†ç¼–ç  | åŸç”ŸGCJ02 |
| AMap.AutoComplete | âœ… å®Œå…¨é›†æˆ | åœ°å€æœç´¢ | é˜²æŠ–ä¼˜åŒ– |
| AMap.PlaceSearch | âœ… å®Œå…¨é›†æˆ | POIæœç´¢ | æ”¯æŒå‘¨è¾¹æœç´¢ |
| é«˜å¾·Web Service API | âš ï¸ ä»…å¤‡ç”¨ | é€†åœ°ç†ç¼–ç  | NativeMapViewä½¿ç”¨ |
| react-native-maps | âš ï¸ ä¿ç•™æœªç”¨ | åœ°å›¾æ¸²æŸ“ | Apple/Google Maps |
| expo-location | âš ï¸ ä»…è·ç¦»è®¡ç®— | GPSå®šä½ | WGS84åæ ‡ç³» |

---

## ğŸ“‰ 7. æ€§èƒ½æŒ‡æ ‡åˆ†æ

### 7.1 å®é™…æ€§èƒ½æ•°æ®

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **é¦–æ¬¡åŠ è½½** | 1-3ç§’ | WebViewåŠ è½½ + åœ°å›¾åˆå§‹åŒ– |
| **å®šä½è€—æ—¶** | 3-8ç§’ | åŒ…å«GPSè·å– + é€†åœ°ç†ç¼–ç  |
| **å®šä½è¶…æ—¶** | 12ç§’ | é¿å…æ— é™ç­‰å¾… |
| **å†…å­˜ä½¿ç”¨** | 80-100MB | WebView + åœ°å›¾ç¼“å­˜ |
| **åœ°å›¾æ¸²æŸ“** | 60fps | GPUç¡¬ä»¶åŠ é€Ÿ |
| **æ ‡è®°æ¸²æŸ“** | <100ms | 200ä¸ªæ ‡è®°å†…æ— å‹åŠ› |
| **æœç´¢å“åº”** | 200-500ms | ç½‘ç»œ + APIå“åº” |

### 7.2 å¯¹æ¯”æ•°æ®ï¼ˆä¿®å¤å‰åï¼‰

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å | æå‡ |
|------|--------|--------|------|
| GPSç²¾åº¦ | 80-100ç±³ | <50ç±³ | 40-50% |
| å®šä½æˆåŠŸç‡ | ~85% | ~95% | +10% |
| åœ°å€è§£æç‡ | ~60% | ~90% | +30% |
| è¶…æ—¶æ—¶é—´ | 20ç§’ | 12ç§’ | 40% |
| å®šä½æ–¹æ³• | expo-location | é«˜å¾·åŸç”Ÿ | - |
| åæ ‡ç³» | WGS84 | GCJ02 | - |

---

## âš ï¸ 8. å½“å‰å±€é™æ€§åˆ†æ

### 8.1 æŠ€æœ¯å±€é™æ€§

#### WebView ç›¸å…³
1. **å¯åŠ¨å¼€é”€**ï¼šWebView åˆå§‹åŒ–éœ€è¦1-2ç§’
2. **å†…å­˜å ç”¨**ï¼šç›¸æ¯”åŸç”Ÿç»„ä»¶å¤šå ç”¨30-50MB
3. **è°ƒè¯•å¤æ‚**ï¼šéœ€è¦åŒæ—¶è°ƒè¯• RN å’Œ JS
4. **æ€§èƒ½å¼€é”€**ï¼šJavaScript â†” Native æ¶ˆæ¯ä¼ é€’æœ‰å»¶è¿Ÿ

#### åŠŸèƒ½é™åˆ¶
1. **ç¦»çº¿èƒ½åŠ›**ï¼šä¾èµ–ç½‘ç»œï¼Œæ— ç¦»çº¿åœ°å›¾
2. **åå°å®šä½**ï¼šåº”ç”¨è¿›å…¥åå°ååœæ­¢å®šä½
3. **ç¼“å­˜æœºåˆ¶**ï¼šæœªå®ç°ä½ç½®ç¼“å­˜ï¼Œé¦–æ¬¡åŠ è½½æ…¢
4. **æ‰¹é‡æ“ä½œ**ï¼šæ ‡è®°æ‰¹é‡æ·»åŠ æœ‰æ€§èƒ½å¼€é”€

#### å¹³å°å·®å¼‚
1. **iOSå·®å¼‚**ï¼šWebView åœ¨ iOS ä¸Šæ€§èƒ½ç•¥å¥½
2. **Androidç¢ç‰‡åŒ–**ï¼šä¸åŒAndroidç‰ˆæœ¬æ€§èƒ½å·®å¼‚
3. **Webç«¯å…¼å®¹**ï¼šæµè§ˆå™¨å®‰å…¨ç­–ç•¥é™åˆ¶

### 8.2 ç”¨æˆ·ä½“éªŒå±€é™æ€§

#### åŠ è½½ä½“éªŒ
1. **é¦–æ¬¡åŠ è½½**ï¼šéœ€è¦ç­‰å¾…åœ°å›¾åŠ è½½
2. **å¼±ç½‘ç»œ**ï¼šç½‘ç»œå·®æ—¶åŠ è½½ç¼“æ…¢
3. **å®šä½ç­‰å¾…**ï¼šæœ€åæƒ…å†µä¸‹éœ€ç­‰å¾…12ç§’

#### äº¤äº’ä½“éªŒ
1. **åœ°å›¾äº¤äº’**ï¼šWebView å†…åµŒå¯èƒ½å½±å“æµç•…åº¦
2. **æ ‡è®°ç‚¹å‡»**ï¼šæ¶ˆæ¯ä¼ é€’æœ‰å¾®å°å»¶è¿Ÿ
3. **æ‰‹åŠ¿å†²çª**ï¼šä¸React Nativeæ‰‹åŠ¿å¯èƒ½å†²çª

### 8.3 æ¶æ„å±€é™æ€§

#### åŒé‡å®ç°
1. **ç»´æŠ¤æˆæœ¬**ï¼šéœ€è¦ç»´æŠ¤ä¸¤å¥—åœ°å›¾å®ç°
2. **ä»£ç é‡å¤**ï¼šåŠŸèƒ½é‡å¤å®ç°
3. **æµ‹è¯•å¤æ‚**ï¼šéœ€è¦æµ‹è¯•ä¸¤å¥—æ–¹æ¡ˆ
4. **å†³ç­–å›°éš¾**ï¼šä¸çŸ¥é“ä½•æ—¶ç”¨å“ªå¥—æ–¹æ¡ˆ

#### æŠ€æœ¯å€º
1. **NativeMapView**ï¼šæœªå®Œå…¨ç§»é™¤ï¼Œä»åœ¨ä»£ç åº“
2. **æœªä½¿ç”¨çš„Hook**ï¼šuse-location ä»æœ‰æœªä½¿ç”¨éƒ¨åˆ†
3. **æ–‡æ¡£ç¼ºå¤±**ï¼šæ¶æ„å†³ç­–å†å²ä¸å®Œæ•´

---

## ğŸ”® 9. å®Œå…¨ Amap SDK é›†æˆå¯èƒ½æ€§åˆ†æ

### 9.1 å®Œå…¨é›†æˆçš„æ½œåœ¨ä¼˜åŠ¿

#### æ€§èƒ½æå‡
- **åŠ è½½é€Ÿåº¦**ï¼šæ— éœ€ WebView åˆå§‹åŒ–ï¼ŒèŠ‚çœ1-2ç§’
- **å†…å­˜ä½¿ç”¨**ï¼šå‡å°‘30-50MBå†…å­˜å ç”¨
- **å“åº”é€Ÿåº¦**ï¼šJavaScript â†” Native é€šä¿¡å»¶è¿Ÿæ¶ˆé™¤
- **æ¸²æŸ“æ€§èƒ½**ï¼šåŸç”Ÿæ¸²æŸ“ï¼Œ60fpsç¨³å®š

#### åŠŸèƒ½å¢å¼º
- **ç¦»çº¿åœ°å›¾**ï¼šæ”¯æŒç¦»çº¿åœ°å›¾åŒ…
- **åå°å®šä½**ï¼šæ”¯æŒåº”ç”¨åå°æ—¶æŒç»­å®šä½
- **ç²¾ç¡®æ§åˆ¶**ï¼šæ›´ç»†ç²’åº¦çš„åœ°å›¾æ§åˆ¶
- **é«˜çº§åŠŸèƒ½**ï¼šè·¯å¾„è§„åˆ’ã€å®æ—¶äº¤é€šã€å‘¨è¾¹ç”Ÿæ´»ç­‰

#### å¼€å‘ä½“éªŒ
- **è°ƒè¯•ç®€åŒ–**ï¼šç»Ÿä¸€è°ƒè¯•ç¯å¢ƒ
- **ç±»å‹å®‰å…¨**ï¼šTypeScript å®Œæ•´ç±»å‹å®šä¹‰
- **IDEæ”¯æŒ**ï¼šæ›´å¥½çš„ä»£ç æç¤ºå’Œè¡¥å…¨
- **æµ‹è¯•ç®€åŒ–**ï¼šå•ä¸€å¥—ä»¶ï¼Œæµ‹è¯•æˆæœ¬ä½

### 9.2 å®Œå…¨é›†æˆçš„æŒ‘æˆ˜

#### æŠ€æœ¯æŒ‘æˆ˜
1. **åŸç”Ÿæ¨¡å—å¼€å‘**ï¼šéœ€è¦å¼€å‘ react-native-amap æˆ–ç±»ä¼¼å°è£…
2. **å¹³å°é€‚é…**ï¼šiOSã€Androidã€Web å·®å¼‚é€‚é…
3. **ç‰ˆæœ¬å…¼å®¹**ï¼šRN ç‰ˆæœ¬å‡çº§æ—¶çš„å…¼å®¹æ€§
4. **ä¾èµ–ç®¡ç†**ï¼šåŸç”Ÿä¾èµ–ç‰ˆæœ¬å†²çª

#### å¼€å‘æˆæœ¬
1. **å¼€å‘å‘¨æœŸ**ï¼šé¢„ä¼°2-4å‘¨å¼€å‘æ—¶é—´
2. **æµ‹è¯•æˆæœ¬**ï¼šéœ€è¦å…¨é¢æµ‹è¯•å„å¹³å°
3. **ç»´æŠ¤æˆæœ¬**ï¼šæŒç»­ç»´æŠ¤åŸç”Ÿæ¨¡å—
4. **å­¦ä¹ æˆæœ¬**ï¼šå›¢é˜Ÿéœ€è¦å­¦ä¹ åŸç”Ÿå¼€å‘

#### é£é™©è¯„ä¼°
1. **ç¨³å®šæ€§é£é™©**ï¼šæ–°æ–¹æ¡ˆå¯èƒ½å¼•å…¥æ–°bug
2. **å…¼å®¹æ€§é£é™©**ï¼šä¸ç°æœ‰åŠŸèƒ½å†²çª
3. **å‡çº§é£é™©**ï¼šé«˜å¾·SDKå‡çº§éœ€è¦åŒæ­¥æ›´æ–°
4. **ä¾èµ–é£é™©**ï¼šç¬¬ä¸‰æ–¹åº“ç»´æŠ¤é£é™©

### 9.3 ä¸å½“å‰æ··åˆæ–¹æ¡ˆå¯¹æ¯”

| ç»´åº¦ | å½“å‰WebViewæ–¹æ¡ˆ | å®Œå…¨SDKæ–¹æ¡ˆ |
|------|----------------|-------------|
| **å¼€å‘æˆæœ¬** | ä½ï¼ˆå·²æœ‰å®ç°ï¼‰ | é«˜ï¼ˆéœ€ä»é›¶å¼€å‘ï¼‰ |
| **ç»´æŠ¤æˆæœ¬** | ä¸­ï¼ˆéœ€ç»´æŠ¤ä¸¤å¥—ï¼‰ | ä½ï¼ˆå•ä¸€å¥—ä»¶ï¼‰ |
| **æ€§èƒ½** | ä¸­ç­‰ | é«˜ |
| **å†…å­˜** | 80-100MB | 50-70MB |
| **åŠ è½½é€Ÿåº¦** | 1-3ç§’ | <1ç§’ |
| **åŠŸèƒ½å®Œæ•´æ€§** | 80% | 95%+ |
| **ç¦»çº¿æ”¯æŒ** | âŒ | âœ… |
| **åå°å®šä½** | âŒ | âœ… |
| **è°ƒè¯•å¤æ‚åº¦** | é«˜ï¼ˆåŒç¯å¢ƒï¼‰ | ä¸­ï¼ˆå•ç¯å¢ƒï¼‰ |
| **é£é™©** | ä½ï¼ˆå·²éªŒè¯ï¼‰ | é«˜ï¼ˆæ–°æ–¹æ¡ˆï¼‰ |

### 9.4 æ¸è¿›å¼æ”¹è¿›å»ºè®®

#### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰
1. **ç§»é™¤NativeMapView**ï¼šæ¸…ç†æœªä½¿ç”¨çš„ä»£ç 
2. **ä¼˜åŒ–WebView**ï¼šé¢„åŠ è½½ã€ç¼“å­˜ä¼˜åŒ–
3. **æ·»åŠ ä½ç½®ç¼“å­˜**ï¼šç¼“å­˜æœ€åæˆåŠŸä½ç½®
4. **å®Œå–„æ–‡æ¡£**ï¼šè¡¥å……æ¶æ„å†³ç­–æ–‡æ¡£

#### ä¸­æœŸæ”¹è¿›ï¼ˆ1-2æœˆï¼‰
1. **å¼€å‘åŸç”Ÿå°è£…**ï¼šå¼€å‘ react-native-amap å°è£…
2. **A/Bæµ‹è¯•**ï¼šå¯¹æ¯” WebView å’ŒåŸç”Ÿæ–¹æ¡ˆ
3. **æ€§èƒ½ç›‘æ§**ï¼šæ”¶é›†çœŸå®ç”¨æˆ·æ€§èƒ½æ•°æ®
4. **ç¦»çº¿æ”¯æŒ**ï¼šæ·»åŠ ç¦»çº¿åœ°å›¾æ”¯æŒ

#### é•¿æœŸè§„åˆ’ï¼ˆ3-6æœˆï¼‰
1. **å…¨é¢è¿ç§»**ï¼šé€æ­¥è¿ç§»åˆ°åŸç”Ÿæ–¹æ¡ˆ
2. **é«˜çº§åŠŸèƒ½**ï¼šè·¯å¾„è§„åˆ’ã€å®æ—¶äº¤é€š
3. **AIé›†æˆ**ï¼šæ™ºèƒ½æ¨èã€å›¾åƒè¯†åˆ«
4. **å¤šåœ°å›¾æ”¯æŒ**ï¼šç™¾åº¦ã€è…¾è®¯åœ°å›¾å¤‡é€‰

---

## ğŸ“š 10. æŠ€æœ¯æ–‡æ¡£å®¡æŸ¥

### 10.1 ç°æœ‰æ–‡æ¡£

| æ–‡æ¡£ | çŠ¶æ€ | å†…å®¹ |
|------|------|------|
| PROJECT_SUMMARY.md | âœ… å®Œæ•´ | é¡¹ç›®æ€»ç»“ã€å®šä½ç³»ç»Ÿä¿®å¤ |
| AMAP_API_FIX_REPORT.md | âœ… è¯¦ç»† | é«˜å¾·APIé›†æˆä¿®å¤æŠ¥å‘Š |
| LOCATION_FIX_REPORT.md | âœ… è¯¦ç»† | å®šä½ç³»ç»Ÿä¿®å¤æŠ¥å‘Š |
| CLAUDE.md | âœ… å®Œæ•´ | é¡¹ç›®æŒ‡ä»¤å’Œæ¶æ„è¯´æ˜ |
| openspec/AGENTS.md | âœ… å®Œæ•´ | OpenSpecå·¥ä½œæµ |
| ä»£ç æ³¨é‡Š | âœ… å……åˆ† | å…³é”®é€»è¾‘æœ‰è¯¦ç»†æ³¨é‡Š |

### 10.2 ç¼ºå¤±æ–‡æ¡£

| æ–‡æ¡£ | ä¼˜å…ˆçº§ | è¯´æ˜ |
|------|--------|------|
| åœ°å›¾æ¶æ„å†³ç­–æ–‡æ¡£ | é«˜ | ä¸ºä»€ä¹ˆé€‰æ‹©æ··åˆæ¶æ„ |
| APIç‰ˆæœ¬å‡çº§æŒ‡å— | ä¸­ | é«˜å¾·APIå‡çº§æµç¨‹ |
| æ€§èƒ½ä¼˜åŒ–æŒ‡å— | ä¸­ | WebViewæ€§èƒ½è°ƒä¼˜ |
| æ•…éšœæ’æŸ¥æ‰‹å†Œ | é«˜ | å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ |

---

## ğŸ¯ 11. å…³é”®å‘ç°æ€»ç»“

### 11.1 æ ¸å¿ƒå‘ç°

1. **âœ… æ¶æ„æ¸…æ™°**ï¼šæ··åˆæ¶æ„è®¾è®¡åˆç†ï¼Œé’ˆå¯¹ä¸­å›½å¸‚åœºä¼˜åŒ–
2. **âœ… åŠŸèƒ½å®Œæ•´**ï¼š80%çš„æ ¸å¿ƒåŠŸèƒ½å·²å®ç°å¹¶éªŒè¯
3. **âœ… æ€§èƒ½è‰¯å¥½**ï¼šæ»¡è¶³ç§»åŠ¨ç«¯åº”ç”¨æ€§èƒ½è¦æ±‚
4. **âœ… é”™è¯¯å¤„ç†å®Œå–„**ï¼š5ç§é”™è¯¯ç±»å‹ï¼Œå®Œæ•´å¤„ç†æµç¨‹
5. **âš ï¸ ä»£ç å†—ä½™**ï¼šä¸¤å¥—å®ç°å¹¶å­˜ï¼Œå¢åŠ ç»´æŠ¤æˆæœ¬
6. **âš ï¸ WebViewä¾èµ–**ï¼šæ€§èƒ½ç•¥ä½äºåŸç”Ÿå®ç°

### 11.2 æŠ€æœ¯äº®ç‚¹

1. **åæ ‡ç³»é—®é¢˜è§£å†³**ï¼šå½»åº•è§£å†³WGS84â†”GCJ02è½¬æ¢é—®é¢˜
2. **å®šä½ç²¾åº¦æå‡**ï¼šä»100ç±³æå‡è‡³50ç±³ä»¥å†…
3. **æˆåŠŸç‡æå‡**ï¼šä»85%æå‡è‡³95%
4. **é”™è¯¯å¤„ç†æœºåˆ¶**ï¼šæ™ºèƒ½é‡è¯• + æ˜ç¡®é”™è¯¯åˆ†ç±»
5. **ç”¨æˆ·åé¦ˆä¼˜åŒ–**ï¼šçŠ¶æ€æŒ‡ç¤ºæ¸…æ™°ï¼Œç”¨æˆ·ä½“éªŒå¥½

### 11.3 æŠ€æœ¯å€ºåŠ¡

1. **åŒå®ç°ç»´æŠ¤**ï¼šéœ€è¦ç»´æŠ¤ NativeMapView å’Œ AmapWebView
2. **æœªä½¿ç”¨ä»£ç **ï¼šuse-location éƒ¨åˆ†åŠŸèƒ½æœªä½¿ç”¨
3. **æµ‹è¯•è¦†ç›–**ï¼šç¼ºå°‘è‡ªåŠ¨åŒ–æµ‹è¯•
4. **æ–‡æ¡£ç¼ºå¤±**ï¼šéƒ¨åˆ†æ¶æ„å†³ç­–æœªæ–‡æ¡£åŒ–

### 11.4 æ¶æ„å¥åº·åº¦è¯„ä¼°

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **åŠŸèƒ½å®Œæ•´æ€§** | 8/10 | æ ¸å¿ƒåŠŸèƒ½å®Œæ•´ï¼Œé«˜çº§åŠŸèƒ½å¾…è¡¥å…… |
| **æ€§èƒ½è¡¨ç°** | 7/10 | æ»¡è¶³è¦æ±‚ï¼Œä½†æœ‰ä¼˜åŒ–ç©ºé—´ |
| **ä»£ç è´¨é‡** | 8/10 | æ¸…æ™°ã€è§„èŒƒï¼Œæœ‰æ³¨é‡Š |
| **å¯ç»´æŠ¤æ€§** | 6/10 | åŒå®ç°å¢åŠ ç»´æŠ¤æˆæœ¬ |
| **å¯æ‰©å±•æ€§** | 8/10 | æ¶æ„æ”¯æŒåŠŸèƒ½æ‰©å±• |
| **ç¨³å®šæ€§** | 9/10 | ç»è¿‡éªŒè¯ï¼Œç¨³å®šå¯é  |
| **æ–‡æ¡£å®Œæ•´æ€§** | 8/10 | æ ¸å¿ƒæ–‡æ¡£å®Œæ•´ï¼Œéƒ¨åˆ†ç¼ºå¤± |
| **æµ‹è¯•è¦†ç›–** | 6/10 | æ‰‹åŠ¨æµ‹è¯•ï¼Œç¼ºå°‘è‡ªåŠ¨åŒ– |

**ç»¼åˆè¯„åˆ†ï¼š7.5/10**

---

## ğŸš€ 12. åç»­è¡ŒåŠ¨å»ºè®®

### 12.1 ç«‹å³è¡ŒåŠ¨ï¼ˆæœ¬å‘¨å†…ï¼‰

1. **âœ… æ— éœ€ç«‹å³è¡ŒåŠ¨**ï¼šå½“å‰å®ç°ç¨³å®šå¯ç”¨
2. **ğŸ“ æ–‡æ¡£è¡¥å……**ï¼šè¡¥å……ç¼ºå¤±çš„æŠ€æœ¯æ–‡æ¡£
3. **ğŸ” ä»£ç å®¡è®¡**ï¼šæ£€æŸ¥æ˜¯å¦æœ‰æœªä½¿ç”¨çš„ä»£ç 

### 12.2 çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰

1. **ğŸ§¹ ä»£ç æ¸…ç†**ï¼š
   - ç§»é™¤æˆ–æ ‡è®° NativeMapView ä¸ºåºŸå¼ƒ
   - æ¸…ç†æœªä½¿ç”¨çš„ use-location åŠŸèƒ½
   - æ›´æ–°å¯¼å…¥è·¯å¾„

2. **âš¡ æ€§èƒ½ä¼˜åŒ–**ï¼š
   - å®ç°ä½ç½®ç¼“å­˜æœºåˆ¶
   - é¢„åŠ è½½ WebView
   - ä¼˜åŒ–æ ‡è®°æ¸²æŸ“æ€§èƒ½

3. **ğŸ§ª æµ‹è¯•å®Œå–„**ï¼š
   - æ·»åŠ å•å…ƒæµ‹è¯•
   - æ·»åŠ é›†æˆæµ‹è¯•
   - æ€§èƒ½åŸºå‡†æµ‹è¯•

### 12.3 ä¸­æœŸè§„åˆ’ï¼ˆ1-2æœˆï¼‰

1. **ğŸ”¬ åŸç”Ÿå°è£…**ï¼š
   - å¼€å‘ react-native-amap å°è£…
   - A/Bæµ‹è¯•å¯¹æ¯”æ–¹æ¡ˆ
   - è¯„ä¼°è¿ç§»æˆæœ¬æ•ˆç›Š

2. **ğŸ“Š ç›‘æ§å¢å¼º**ï¼š
   - æ·»åŠ æ€§èƒ½ç›‘æ§
   - æ·»åŠ é”™è¯¯è¿½è¸ª
   - ç”¨æˆ·è¡Œä¸ºåˆ†æ

3. **ğŸ—ºï¸ åŠŸèƒ½å¢å¼º**ï¼š
   - ç¦»çº¿åœ°å›¾æ”¯æŒ
   - è·¯å¾„è§„åˆ’
   - å®æ—¶äº¤é€š

### 12.4 é•¿æœŸè§„åˆ’ï¼ˆ3-6æœˆï¼‰

1. **ğŸ”„ å…¨é¢è¿ç§»**ï¼š
   - åŸºäºæµ‹è¯•ç»“æœå†³ç­–
   - é€æ­¥è¿ç§»åˆ°åŸç”Ÿæ–¹æ¡ˆ
   - å®Œå…¨ç§»é™¤ WebView æ–¹æ¡ˆ

2. **ğŸ¨ ä½“éªŒä¼˜åŒ–**ï¼š
   - 3Dåœ°å›¾æ”¯æŒ
   - å®¤å†…åœ°å›¾
   - ARå¯¼èˆª

3. **ğŸ¤– AIé›†æˆ**ï¼š
   - æ™ºèƒ½ä½ç½®æ¨è
   - å›¾åƒè¯†åˆ«
   - æ™ºèƒ½è·¯çº¿è§„åˆ’

---

## ğŸ“ é™„å½•

### A. å…³é”®æ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶è·¯å¾„ | åŠŸèƒ½ | é‡è¦æ€§ |
|----------|------|--------|
| components/AmapWebView.tsx | æ ¸å¿ƒåœ°å›¾ç»„ä»¶ | â­â­â­â­â­ |
| utils/amap-js-bridge.ts | é«˜å¾·JSæ¡¥æ¥ | â­â­â­â­â­ |
| constants/amap-config.ts | åœ°å›¾é…ç½® | â­â­â­â­ |
| config/amap-api-keys.ts | APIå¯†é’¥ç®¡ç† | â­â­â­â­ |
| hooks/use-amap-location.ts | é«˜å¾·å®šä½é’©å­ | â­â­â­ |
| components/AddressSearch.tsx | åœ°å€æœç´¢ | â­â­â­ |
| contexts/LocationContext.tsx | ä½ç½®ä¸Šä¸‹æ–‡ | â­â­â­ |
| components/NativeMapView.tsx | å¤‡ç”¨åœ°å›¾ç»„ä»¶ | â­â­ |
| hooks/use-location.ts | åŸºç¡€å®šä½é’©å­ | â­â­ |
| app/(tabs)/index.tsx | é¦–é¡µä½¿ç”¨ç¤ºä¾‹ | â­â­â­â­â­ |
| app/select-location.tsx | ä½ç½®é€‰æ‹©ç¤ºä¾‹ | â­â­â­â­ |

### B. å¤–éƒ¨ä¾èµ–

```json
{
  "react-native-maps": "^1.20.1",
  "react-native-webview": "^13.15.0",
  "expo-location": "^19.0.7",
  "expo-secure-store": "^15.0.7"
}
```

### C. é«˜å¾·APIæ’ä»¶åˆ—è¡¨

```javascript
AMap.Geolocation    // å®šä½æœåŠ¡
AMap.Geocoder       // é€†åœ°ç†ç¼–ç 
AMap.AutoComplete   // è‡ªåŠ¨è¡¥å…¨
AMap.PlaceSearch    // POIæœç´¢
AMap.Driving        // é©¾è½¦è§„åˆ’ï¼ˆå¯é€‰ï¼‰
AMap.Transfer       // å…¬äº¤è§„åˆ’ï¼ˆå¯é€‰ï¼‰
AMap.Walking        // æ­¥è¡Œè§„åˆ’ï¼ˆå¯é€‰ï¼‰
```

### D. åæ ‡ç³»è½¬æ¢å·¥å…·ï¼ˆå¦‚æœéœ€è¦ï¼‰

```typescript
// WGS84 â†’ GCJ02 è½¬æ¢ï¼ˆé¡¹ç›®å½“å‰æœªä½¿ç”¨ï¼‰
function wgs84ToGcj02(lng: number, lat: number) {
  // è½¬æ¢ç®—æ³•å®ç°
  // é¡¹ç›®å½“å‰ä½¿ç”¨é«˜å¾·åŸç”Ÿï¼Œå·²æ— éœ€è½¬æ¢
}
```

---

## ğŸ“ æ”¯æŒä¿¡æ¯

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0.0  
**åˆ†ææ—¥æœŸ**ï¼š2025-11-20  
**åˆ†æèŒƒå›´**ï¼šå…¨é¡¹ç›®åœ°å›¾å®ç°  
**æ–‡æ¡£çŠ¶æ€**ï¼šâœ… å®Œæˆ  

**ä¸»è¦å‚è€ƒ**ï¼š
- é¡¹ç›®æºä»£ç ï¼ˆå·²å®¡æŸ¥ï¼‰
- ç°æœ‰æ–‡æ¡£ï¼ˆPROJECT_SUMMARY.md, AMAP_API_FIX_REPORT.md, LOCATION_FIX_REPORT.mdï¼‰
- é«˜å¾·åœ°å›¾å®˜æ–¹æ–‡æ¡£

**å»ºè®®ä¸‹ä¸€æ­¥**ï¼š
1. æ ¹æ®æœ¬åˆ†æåˆ¶å®šä¼˜åŒ–è®¡åˆ’
2. å¼€å§‹çŸ­æœŸä¼˜åŒ–ä»»åŠ¡
3. è¯„ä¼°ä¸­æœŸåŸç”Ÿå°è£…å¯è¡Œæ€§
4. æŒç»­ç›‘æ§ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½æ•°æ®
